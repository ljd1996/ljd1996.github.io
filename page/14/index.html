<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"ljd1996.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="梦里寻她千百度，蓦然回首，那人却在，灯火阑珊处。">
<meta property="og:type" content="website">
<meta property="og:title" content="苍耳的博客">
<meta property="og:url" content="https://ljd1996.github.io/page/14/index.html">
<meta property="og:site_name" content="苍耳的博客">
<meta property="og:description" content="梦里寻她千百度，蓦然回首，那人却在，灯火阑珊处。">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="苍耳叔叔">
<meta property="article:tag" content="诗歌，宋词，后台，Android，Java">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://ljd1996.github.io/page/14/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>苍耳的博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">苍耳的博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">细水长流</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://ljd1996.github.io/2018/12/10/%E8%BF%85%E9%9B%B7%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="苍耳叔叔">
      <meta itemprop="description" content="梦里寻她千百度，蓦然回首，那人却在，灯火阑珊处。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="苍耳的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/12/10/%E8%BF%85%E9%9B%B7%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90/" class="post-title-link" itemprop="url">迅雷案例分析</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-12-10 21:19:46" itemprop="dateCreated datePublished" datetime="2018-12-10T21:19:46+08:00">2018-12-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-14 14:14:58" itemprop="dateModified" datetime="2021-05-14T14:14:58+08:00">2021-05-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E4%BD%9C%E4%B8%9A/" itemprop="url" rel="index"><span itemprop="name">作业</span></a>
                </span>
            </span>

          
            <span id="/2018/12/10/%E8%BF%85%E9%9B%B7%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90/" class="post-meta-item leancloud_visitors" data-flag-title="迅雷案例分析" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2018/12/10/%E8%BF%85%E9%9B%B7%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2018/12/10/%E8%BF%85%E9%9B%B7%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>”深圳市迅雷网络技术有限公司“前身称“深圳市三代科技开发有限公司”（简称“三代科技”），三代科技开发有限公司于2002年底由邹胜龙先生及程浩先生始创于美国硅谷。2003年1月底，两位创办者回国发展并正式成立深圳市三代科技开发有限公司（简称“三代科技”）。由于发展的需要，“三代科技”于2005年5月正式更名为“深圳市迅雷网络技术有限公司”，暨迅雷在大中华区的研发中心和运营中心。即我们通常所称的“迅雷”。</p>
<p>迅雷立足于为全球互联网提供最好的多媒体下载服务。经过艰苦创业，迅雷在大中华地区以领先的技术和诚信的服务，赢得广大用户的深深喜爱和许多合作伙伴的认同与支持。公司旗舰产品，迅雷，已经成为中国互联网最流行的应用服务软件之一。后又陆续开始进军云计算与区块链领域，推出了玩客云，星域云和迅雷链等产品。<font color="0000FF">[1]</font></p>
<h2 id="过程"><a href="#过程" class="headerlink" title="过程"></a>过程</h2><p>迅雷的一些发展历程：</p>
<ul>
<li>2006年，迅雷用户数突破1亿，成为用户规模最大的下载加速软件</li>
<li>2007年，迅雷首次对外发布视频业务迅雷看看</li>
<li>2008年，发布迅雷软件助手、迅雷游戏、迅雷安全助手等</li>
<li>2009年，迅雷群侠传网页游戏发布；迅雷会员系统正式发布</li>
<li>2010年，迅雷用户数突破3亿，付费用户达100万</li>
<li>2011年，迅雷看看成为国内首家实现全网高清的在线视频网站</li>
<li>2012年，手机迅雷发布，手机下载进入高速时代</li>
<li>2013年，迅雷用户数突破4.6亿，付费用户达520万</li>
<li>2014年，迅雷开始做云计算和CDN服务</li>
<li>2015年，迅雷、小米联合发布“星域CDN”，随后星域CDN陆续与小米、爱奇艺达成战略合作；迅雷赚钱宝Pro上市，引发用户秒抢热潮</li>
<li>2016年，迅雷赚钱宝全新升级为星域共享平台，获得超过400万“玩客”支持；星域CDN发布“卓越版”和“标准版”直播新品，成为小米、爱奇艺、熊猫直播、bilibili、陌陌等百家企业直播业务首选服务商</li>
<li>2017年，迅雷短视频日均播放量破亿；迅雷召开玩客云战略发布会，宣布共享计算和区块链的全新战略</li>
<li>2018年，超级区块链平台迅雷链正式发布，引领区块链进入3.0时代；星域CDN升级为综合型云计算平台——星域云；迅雷举办全球区块链应用大赛</li>
</ul>
<h2 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h2><p>提起”迅雷“这个词，可能大部分的人心中都是满满的回忆感，如一个相处十多年的老友般熟悉，可如今细细想来，去网上搜一搜迅雷现在的业务，却会发现现在的迅雷早已经不是当初那个只有下载业务，靠着会员收费盈利的公司了，它早已不仅仅是一个简单的下载工具了。</p>
<p>迅雷早期的时候，是一个比较纯粹的下载工具，在下载领域，前前后后出现过许多的下载工具，如QQ旋风，VeryCD电驴,快车等，也都成功过，但在技术与行业的发展之下，最终活下来的只有迅雷。在2007年前后，几乎每个PC用户有两个软件都是必装的，一个是QQ，而另一个便是迅雷。当时迅雷用户达到了4亿，装机量达到8000万台，市场份额超过50%，是中国互联网仅次于QQ的客户端软件。而达到这一成就，迅雷仅仅用了4年。这样的迅雷曾经感染了无数的有志青年，在那段时间，有许多的腾讯员工跳槽到了迅雷，弄得腾讯非常紧张，甚至影响到了马化腾。腾讯前产品运营副总监黄卓生回忆道，“Pony挺忌惮这个事，在内部开会，要抢占这个入口，在PC时代，大家都还在强调装机量。”<font color="0000FF">[2]</font> 腾讯后来推出了QQ旋风，可惜最后也败下阵来，停更下架。</p>
<p>然而，迅雷却没有如腾讯等公司一样抓住发展的机遇，扶摇直上，发展成为互联网大头，反之，迅雷前几年一直在走下坡路，接连错过了许多的发展机遇与风口，慢慢地从巨无霸沦落成为了路人，而前段时间迅雷的内讧,也让人唏嘘。</p>
<p>曾经有许多专业人士，其中也包括迅雷自己内部的管理人员，对迅雷错过的一些风口做过总结，迅雷在互联网的发展过程中，先后错过了”浏览器”，“流媒体”以及“应用商店”等重要的机遇。一观迅雷的发展历程，迅雷都曾从这些风口中找到过切入点，投入过一小部分资源发展这些方向，但大部分都浅尝辄止，等到重点投入资源的时候，已经是红海市场了。</p>
<h2 id="转折"><a href="#转折" class="headerlink" title="转折"></a>转折</h2><p>2014年11月，前腾讯云计算公司总裁陈磊正式出任迅雷CTO，同时兼任迅雷旗下网心科技CEO，2015年11月，迅雷董事会通过决议任命陈磊为迅雷网络技术有限公司联席CEO。陈磊曾在腾讯负责过腾讯云和腾讯开放平台的管理工作，也曾在Google和微软从事过云计算相关的工作。由下载工具起家的迅雷，却选了一个云计算相关的人才做CEO，事情自然会有所转折。</p>
<p>果然，陈磊没有辜负大家的期望。在他上任后，他对公司业务方向做出了果断的调整，始终坚持以技术创新带动业务发展的策略，也取得了一些阶段性的成果。近两年来，迅雷推出了一个名为星域云的产品，这是一款创新型的云计算产品。2017年年初，迅雷的云计算业务营收规模开始高速增长，连续多个季度均保持数十个百分比的增速。在云计算业务的拉动下，迅雷逐渐突破了原有的商业模式，不再局限于传统的下载业务，而是在其基础之上衍生出了一些更具发展前景的新业务。</p>
<p>2018年11月14日，迅雷正式发布了截至2018年9月30日的第三季度未经审计的财务报告。财报显示，迅雷报告期内总营收为4530万美元，同比增长1.1%，连续3年实现同比增长；毛利率52.7%，而2017年同期为35.5%。<font color="0000FF">[3]</font></p>
<p>而毛利率提升的主要原因来自于带宽成本的大幅降低，这主要得益于迅雷独有的共享计算模式，它通过玩客云收集闲置的带宽资源，进行再分配，从而让用户就近获取内容，加快访问速度。而对于用户来说，它通过赚钱宝奖励的方式使用户贡献出自己的闲置带宽，用户从中获得奖励，而迅雷则使得这些用户无形之中都成为了自己的CDN节点，大幅度地降低了部署CDN的成本。</p>
<p>在云计算成为迅雷的业务重心后，它还在集中资源发展其区块链业务，吸取之前对错过的风口浅尝辄止的教训，看准了方向之后，All in区块链，在风口之上创新。迅雷是国内共享计算与区块链的先行者，已实现将区块链技术与共享计算业务结合，吸引了海量共享计算的参与者。2018年4月，迅雷正式发布了当前全球范围内唯一实现百万TPS性能的主链——迅雷链，同期迅雷也举办了一场全球区块链开发大赛，为迅雷链聚集了两千多名来自世界各地的开发者。在7月初的大赛决赛上，迅雷又发布了其自主研发的一个迅雷链文件系统TCFS(Thunder Chain File System)，进一步完善了迅雷链的开发者生态。这些技术高度让迅雷成为国内区块链行业的领军者，目前迅雷链已经向生态化发展，并被视为区块链3.0时代的标杆性主链。</p>
<p>在今年的第三季度，迅雷及旗下网心科技被中国管理科学研究院授予“中国区块链技术示范基地”，以表彰迅雷在区块链行业的领头作用以及为行业发展做出的重大贡献。同年10月份，在世界级管理奖项“拉姆.查兰管理实践奖”的评选中，迅雷集团凭借近几年的成功转型实践，荣获了这一管理界的重量级荣誉奖项。</p>
<h2 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h2><p>平心而论，迅雷的技术能力是很强的，它本身也长于技术上的创新，他们发明了P2SP的内容传输算法，并第一个将之用于实际应用，同时也第一个将P2SP应用在流媒体点播领域。在最近一年，迅雷又用共享的思想颠覆了传统CDN的应用方式，通过玩客云将家庭中原本闲置的带宽、存储和计算资源收集回收，转化为低成本的云计算服务输送至互联网企业。共享计算绕开了传统云计算耗能耗资巨大的数据中心模式，从而得以实现带宽成本的大幅度降低。</p>
<p>然而，迅雷之所以错过了这么多的机遇，有一个原因是没有定好一个准确而正确的战略，战略上的不确定，会导致战术的失误，也因此，迅雷虽然都有涉足过浏览器，流媒体以及应用商店等方向，却都没有深入地进行研究与开发，没有All in 他们的优势资源，最终导致当行业已经到了红海之时，已经失去了最好的时机。</p>
<p>而对于当时的CEO邹胜龙先生来说，很多人把矛头指向了他。他过于干涉项目，总是亲自去参与某些项目，自身过于深入项目的细节。CEO在很多时候，应该关注大方向，而不是过度执着于某些细节，不然反而会成为项目进行的阻碍。在迅雷的历史上，有几个里程碑式的大版本，比如说迅雷6，就是邹胜龙亲自关心开发的，最后却都不了了之。和他对比鲜明的是马化腾，马化腾自己会亲自去体验产品，对产品的细节要求很严格，但他从来只把握大方向，提出要修改的细节，却不会干涉项目具体的执行。</p>
<p>另外，邹胜龙先生也过于关注技术了，总给人一种理工男，技术宅的感觉，从没有站出来为自己的产品代言过。而且他凡事太过于精打细算，放不开。就像当年做视频一样，他由于觉得版权价格太高而选择了退出，结果却错失良机。</p>
<p>在迅雷的巅峰岁月2007的年初，《环球企业家》杂志采访邹胜龙，问他当年的最重要目标是什么，邹胜龙的回答却是：“保住目前的市场份额”。当时的竞争已经很激烈了，腾讯的竞争产品已经推出来了，网际快车也准备卷土重来。然而他的目标不是与竞争对手争，而是保住目前的市场份额，这也许是跟他的性格有关吧，他不喜欢打仗，喜欢关起门来把事做好，一个标准的技术男形象。</p>
<p>在陈磊上任CEO之后，针对迅雷的发展，提出了改革和转型的方案，突破传统的局限，开展新业务，进军云计算和区块链的领域，不止在技术上创新，同时也追求商业模式上的创新，抓住发展趋势，明确战略方向，重点投入资源发展，使这个曾经的巨无霸有了新的转机与发展。</p>
<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><ul>
<li>领导者不应事事亲为，过分拘泥于细节</li>
<li>领导者需要有长远的眼光，不能只在意眼前的得失</li>
<li>领导者需要能看清楚发展的趋势，企业或者公司需要有明确的战略方向，才能决定投入的资源比例，才能抓住机遇。</li>
<li>在互联网行业，需要有创新才能更好地发展，如果故步自封，踟蹰不前，则终将被淘汰。</li>
<li>技术创新固然重要，商业模式上的创新也不容忽视。</li>
</ul>
<h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><p><font color="0000FF">[1]</font>：百度百科词条：深圳市迅雷网络技术有限公司<br><font color="0000FF">[2]</font>：投资界：<a target="_blank" rel="noopener" href="https://news.pedaily.cn/201711/423767.shtml">https://news.pedaily.cn/201711/423767.shtml</a><br><font color="0000FF">[3]</font>：同花顺财经：<a target="_blank" rel="noopener" href="http://stock.10jqka.com.cn/usstock/20181114/c608162184.shtml">http://stock.10jqka.com.cn/usstock/20181114/c608162184.shtml</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://ljd1996.github.io/2018/12/05/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="苍耳叔叔">
      <meta itemprop="description" content="梦里寻她千百度，蓦然回首，那人却在，灯火阑珊处。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="苍耳的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/12/05/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">区块链入门笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-12-05 21:20:32" itemprop="dateCreated datePublished" datetime="2018-12-05T21:20:32+08:00">2018-12-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-14 14:14:57" itemprop="dateModified" datetime="2021-05-14T14:14:57+08:00">2021-05-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/" itemprop="url" rel="index"><span itemprop="name">区块链</span></a>
                </span>
            </span>

          
            <span id="/2018/12/05/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0/" class="post-meta-item leancloud_visitors" data-flag-title="区块链入门笔记" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2018/12/05/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2018/12/05/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B0/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="区块链概述"><a href="#区块链概述" class="headerlink" title="区块链概述"></a>区块链概述</h1><p>区块链并非单一创新技术，而是将许多跨领域技术凑在一起，包括密码学、数学、演算法与经济模型，并结合点对点网路关系，利用数学基础就能建立信任效果，成为一个不需基于彼此信任基础、也不需仰赖单一中心化机构就能够运作的分散式系统，而比特币便是第一个采用区块链技术而打造出的一套P2P电子现金系统，用来实现一个可去中心化，并确保交易安全性、可追踪性的数位货币体系。</p>
<p>区块链:一种特殊的公开的分布式数据库,具有分布式存储，分布式记录，去中心化，分布式维护等特性。</p>
<ul>
<li>全民记账</li>
<li>不可篡改（只能增查,不能改删）</li>
<li>可追溯</li>
<li>去中心化</li>
</ul>
<p>核心技术：</p>
<ul>
<li>区块链底层</li>
<li>智能合约</li>
<li>密码学和数字签名用于身份地址标识</li>
<li>共识算法用于工作量证明</li>
<li>分布式存储技术用于存储交易记录和区块，分布式网络技术用于网络通信和节点发现</li>
</ul>
<p>区块链分类:</p>
<ul>
<li>共有链</li>
<li>私有链</li>
<li>联盟链</li>
</ul>
<p>区块链版本：</p>
<ul>
<li>区块链1.0-可编程货币：数字货币去中心化，数字化货币及支付系统</li>
<li>区块链2.0-可编程金融：智能合约，数字资产，金融应用</li>
<li>区块链3.0-可编程社会：去中心化互信网络，去中心化信任机制，公证，仲裁，审计，物流，医疗等领域</li>
</ul>
<p>区块链2.0是指智能合约,智能合约与货币相结合,对金融领域提供了更加广泛的应用场景，代表是’以太坊’，以太坊 = 区块链 + 智能合约。</p>
<img src="区块链的发展.png"/>

<h1 id="账本验证"><a href="#账本验证" class="headerlink" title="账本验证"></a>账本验证</h1><ul>
<li>Hash</li>
</ul>
<h1 id="账户所有权"><a href="#账户所有权" class="headerlink" title="账户所有权"></a>账户所有权</h1><p>非对称加密：公开密钥与私有密钥是一对，如果用公开密钥对数据进行加密，只有用对应的私有密钥才能解密；因为加密和解密使用的是两个不同的密钥，所以这种算法叫作非对称加密算法。</p>
<ul>
<li>账户用一个地址（Hash值）来标识</li>
<li>一个地址拥有一个私钥（如果私钥丢失了，比特币可能会丢失；私钥丢失了的话，是不能找回的；私钥可以通过两次哈希处理得到地址，而地址不能推导出私钥；非对称）</li>
<li>不泄露私钥的情况下证明我们拥有某个地址的私钥：通过交易签名（非对称）的方式<ul>
<li>把交易进行Hash得到摘要</li>
<li>用私钥对摘要进行签名（加密）,同时私钥也生成付款方的公钥</li>
<li>广播交易，验证信息</li>
<li>用签名和付款方的公钥进行验证，返回交易摘要，验证是否是原始的交易信息（解密）</li>
</ul>
</li>
</ul>
<p>私钥-公钥关系:</p>
<ul>
<li>公钥和私钥成对出现</li>
<li>公开的密钥叫公钥，只有自己知道的叫私钥</li>
<li>用公钥加密的数据只有对应的私钥可以解密</li>
<li>用私钥加密的数据只有对应的公钥可以解密</li>
<li>如果可以用公钥解密，则必然是对应的私钥加的密</li>
<li>如果可以用私钥解密，则必然是对应的公钥加的密</li>
</ul>
<img src="私钥和公钥.png"/>

<h1 id="钱包"><a href="#钱包" class="headerlink" title="钱包"></a>钱包</h1><p>加密数字货币是一种基于区块链技术的数字货币，加密数字货币钱包是专门用来管理这些资产的应用。加密数字货币钱包提供钱包地址的创建、加密数字货币转账、每个钱包地址交易历史的查询等基础金融功能。钱包应用按照密码学原理创建1个或多个钱包地址，每个钱包地址都对应1个密钥对：私钥和公钥。公钥是根据私钥进行一定的数学运算生成，与私钥一一对应。公钥主要是对外交易使用，每次交易都必须使用私钥对交易记录进行签名以证明对相关钱包地址里面的资产有控制权。私钥是唯一能够证明对于数字资产有控制权的凭证,因此对于数字资产钱包来说，私钥是最重要的。私钥的生成和存储方式决定了资产安全与否。因此，通常意义上的数字资产安全其实就是私钥的安全，一个钱包是不是安全主要看它能否安全的管理和使用私钥。</p>
<h1 id="挖矿（记账）"><a href="#挖矿（记账）" class="headerlink" title="挖矿（记账）"></a>挖矿（记账）</h1><ul>
<li>记账：Hash打包过程</li>
<li>节点消耗资源，有奖励</li>
</ul>
<p>挖矿-工作量证明：</p>
<ol>
<li>一段时间内，只有一人可以记账成功</li>
<li>通过解决密码学难题（即工作量证明）竞争获得唯一记账权</li>
<li>其他节点复制记账结果</li>
</ol>
<p>普通的hash打包过程会获得一个摘要信息（hash值），规定获得的摘要信息必须以特定值开头才能算作挖矿成功，获得唯一记账权，故需要引入一个“随机数”作为Hash运算的参数。</p>
<h1 id="共识机制"><a href="#共识机制" class="headerlink" title="共识机制"></a>共识机制</h1><ul>
<li>两个节点同时完成工作量证明，使用谁的区块，使用共识机制。</li>
<li>节点工作量只有在其他得节点认同其是有效的，因此会主动遵守规定</li>
<li>每个节点会选择一条累计工作量最大（最长）的区块链，延长最长链</li>
</ul>
<img src="分叉解决.png"/>

<p>例如，两个节点同时完成工作量证明，分别打包成3458A和3458B，周围的节点选择出累计工作量最大（/最长）的区块链为3458A后进行广播，以3458A作为主链，3458B作为备用链。若之后节点接收到3458B传来的3459B区块，周围的节点选择出累计工作量最大（/最长）的区块链为3458B&lt;——3459B，此时再把备用链3458B作为主链，3458B&lt;——3459B接入区块链。有时候某些节点先接收了3459B，此时会将3459B作为孤块保存，一旦该节点接收到3458B，就会将3458B&lt;——3459B接入区块链。</p>
<h1 id="交易原理"><a href="#交易原理" class="headerlink" title="交易原理"></a>交易原理</h1><p>当你发起一笔比特币交易后，将交易广播到全网，挖矿节点接收到交易后，先将其放入本地内存池进行一些基本验证，比如该笔交易发费的比特币是否是未被花费的交易，如果验证成功，则将其放入”未确认交易池“等待被打包，如果验证失败，则被标记为”无效交易“不会被打包，也就是说，旷工在寻找nonce的同时还需要及时验证每笔交易。</p>
<p>所谓比特币交易就是从一个比特币钱包向另一个中转账，每笔交易都有数字签名来保证安全。一个交易一旦发生那么就是对所有人都公开的，每个交易的历史可以最终追溯到相应的比特币最初被挖出来的那个点。</p>
<p>比特币转账需要支付给旷工手续费，按交易所占的字节数计费，旷工一般会优先打包手续费高的交易到区块里。</p>
<h2 id="比特币的UTXO模型"><a href="#比特币的UTXO模型" class="headerlink" title="比特币的UTXO模型"></a>比特币的UTXO模型</h2><p>比特币系统没有余额的概念，它使用的是UTXO模型（Unspent Transaction Outputs，未使用过的交易输出），我们在交易过程中经常说的钱包余额，实际上是一个钱包地址的UTXO集合。所以，在比特币网络中，存储比特币余额的是交易输出，准确点说就是未使用过的交易输出，而每一笔交易的输入实际上引用的是上一笔交易的输出。所以，要计算一个用户的比特币余额，就需要遍历整个交易的历史。而以太坊由于采用了Account模型，也就是采用余额的概念，所以不需要溯源整个交易历史。</p>
<img src="交易输入输出过程.jpg"/>

<h2 id="交易分类"><a href="#交易分类" class="headerlink" title="交易分类"></a>交易分类</h2><p>交易分为2类：</p>
<ul>
<li>Coinbase交易：挖矿奖励，没有输入，只有输出</li>
<li>普通交易：用户之间的普通转账交易</li>
</ul>
<h2 id="交易过程"><a href="#交易过程" class="headerlink" title="交易过程"></a>交易过程</h2><img src="交易输入结构.png"/>

<img src="交易输出结构.png"/>

<p>假设，由于Alice挖矿被奖励了12.5个比特币。而Alice在一笔交易中，需要转账给Bob10个比特币。而Bob最终确认并接收了Alice发送的10个比特币，而同时由于多出了2.5个比特币。其实这笔交易最终是生成了2个输出，一个是发送给Bob的10个比特币，另一个是找零产生的发给Alice的2.5个比特币（备注：这里不考虑交易费）。</p>
<img src="交易基本过程.png"/>

<p>Alice的锁定脚本的作用是，设定成只有Alice才能使用这笔输出。而要使用这个UTXO，就必须要证明自己是Alice。</p>
<p>比特币交易解码后的内容:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;version&quot;: 1,    </span><br><span class="line">    &quot;locktime&quot;: 0,    </span><br><span class="line">    #交易输入(input)部分</span><br><span class="line">    &quot;vin&quot;: [           </span><br><span class="line">    &#123;    </span><br><span class="line">        #输入引用的交易(transaction)HASH</span><br><span class="line">        &quot;txid&quot;: &quot;7957a35fe64f80d234d76d83a2a8f1a0d8149a41d81de548f0a65a8a999f6f18&quot;,       </span><br><span class="line">        </span><br><span class="line">        #引用交易中的UTXO索引（第一个为0，此处代表上述txid交易中的第一个UTXO）</span><br><span class="line">        &quot;vout&quot;: 0,                                    </span><br><span class="line">        </span><br><span class="line">        #解锁脚本，用于解锁UTXO的脚本（这是可以花费这笔UTXO的关键信息）</span><br><span class="line">        &quot;scriptSig&quot;: &quot;3045022100884d142d86652a3f47ba4746ec719bbfbd040a570b1deccbb6498c75c4ae24cb02204b9f039ff08df09cbe9f6addac960298cad530a863ea8f53982c09db8f6e3813</span><br><span class="line">        [ALL] 0484ecc0d46f1918b30928fa0e4ed99f16a0fb4fde0735e7ade8416ab9fe423cc5412336376789d172787ec3457eee41c04f4938de5cc17b4a10fa336a8d752adf&quot;,          </span><br><span class="line">        &quot;sequence&quot;: 4294967295            </span><br><span class="line">    &#125;    </span><br><span class="line">    ],    </span><br><span class="line">    #交易输出(output)部分 </span><br><span class="line">    &quot;vout&quot;: [         </span><br><span class="line">    &#123;    </span><br><span class="line">        #第一个输出的比特币数量</span><br><span class="line">        &quot;value&quot;: 0.01500000,             </span><br><span class="line">        #锁定脚本，后续的交易如要使用该输出，必须解锁锁定脚本</span><br><span class="line">        &quot;scriptPubKey&quot;: &quot;OP_DUP OP_HASH160 ab68025513c3dbd2f7b92a94e0581f5d50f654e7 OP_EQUALVERIFY OP_CHECKSIG&quot;          </span><br><span class="line">    &#125;,    </span><br><span class="line">    &#123;    </span><br><span class="line">        #第二个输出的比特币数量</span><br><span class="line">        &quot;value&quot;: 0.08450000,             </span><br><span class="line">        &quot;scriptPubKey&quot;: &quot;OP_DUP OP_HASH160 7f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a8 OP_EQUALVERIFY OP_CHECKSIG&quot;,    </span><br><span class="line">    &#125;    </span><br><span class="line">    ]    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="交易脚本"><a href="#交易脚本" class="headerlink" title="交易脚本"></a>交易脚本</h2><p>比特币客户端使用一个用类Forth脚本语言编写的脚本去验证比特币的交易，这个脚本语言不是图灵完备的，不具备循环等复杂的特性。它是一种基于堆栈的执行语言，该脚本语言的简单特性，虽然使得它不能实现复杂的功能，但是也提高了交易脚本的安全性（设计简单，减少了攻击面）。而以太坊就是诟病比特币交易脚本功能有限，所以设计了一个图灵完备的脚本语言，也就是我们常说的智能合约脚本语言，能实现更复杂的功能，但同时也增加了安全隐患。</p>
<p>当一笔比特币交易被验证时，每一个输入中的解锁脚本与其所引用的输出中的锁定脚本同时执行，从而检查这笔交易是否有效。如图所示，是最为常见类型的比特币交易的解锁和锁定脚本:</p>
<img src="解锁脚本和锁定脚本.png"/>

<p>验证过程:当我们拿到一笔交易时，将当前输入的解锁脚本，和该输入所引用的上一笔交易输出的锁定脚本进行特定的验证过程，最终若返回TRUE，说明交易有效。</p>
<h1 id="区块链架构模型"><a href="#区块链架构模型" class="headerlink" title="区块链架构模型"></a>区块链架构模型</h1><img src="区块链架构模型.jpg"/>

<ul>
<li>数据层：封装了底层数据区块的链式结构，以及相关的非对称的公钥私钥加密技术和时间戳技术；是整个区块链最底层的数据结构。</li>
<li>网络层：P2P机制，数据传播机制，数据间认证机制</li>
<li>共识层：共识机制算法</li>
<li>激励层：用于公有链，联盟链</li>
<li>合约层：智能合约</li>
<li>应用层：与上述区块链核心架构分开部署，通过RPC（Remote Procedure Call:远程过程调用)互联</li>
</ul>
<h1 id="链式结构"><a href="#链式结构" class="headerlink" title="链式结构"></a>链式结构</h1><img src="链式结构图.jpg"/>

<p>Hash函数:</p>
<ul>
<li>MD系列:已经不再安全</li>
<li>SHA系列:推荐SHA256, SHA3</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hash</span><span class="params">(input <span class="keyword">string</span>)</span> <span class="title">string</span></span>  &#123;</span><br><span class="line">    <span class="comment">// func Sum256(data []byte) [Size]byte</span></span><br><span class="line">    hashInByte :=sha256.Sum256([]<span class="keyword">byte</span> (input))</span><br><span class="line">    <span class="comment">// func EncodeToString(src []byte) string</span></span><br><span class="line">    <span class="keyword">return</span> hex.EncodeToString(hashInByte[:])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="ICO和IPO"><a href="#ICO和IPO" class="headerlink" title="ICO和IPO"></a>ICO和IPO</h1><ul>
<li>ICO（Initial Coin Offering），首次币发行，源自股票市场的首次公开发行（IPO）概念，是区块链项目首次发行代币，募集比特币、以太坊等通用数字货币的行为。</li>
<li>IPO（Initial Public Offerings），首次公开募股，是指一家企业或公司 （股份有限公司）第一次将它的股份向公众出售（首次公开发行，指股份公司首次向社会公众公开招股的发行方式）。</li>
</ul>
<h1 id="智能合约"><a href="#智能合约" class="headerlink" title="智能合约"></a>智能合约</h1><p>智能合约是一套以数字形式定义的承诺，包括合约参与方可以在上面执行这些承诺的协议，也就是说智能合约是一套能够自动执行某些手动才能完成任务的协议。其实智能合约相当于在计算机系统中构建一份参与方均可读的合同。只有当某一事件触发后，则会立即执行。例如，A向B付款XX元，B则给予A货物。</p>
<p>智能合约并不是一定要依赖于区块链来实现，而区块链的部分基础特性决定了智能合约更加适合于在区块链上来实现。比如去中心化，数据的防篡改，高可用性等。去中心化能够保证数据的全网备份与不可受第三方机构的干扰，无需担心数据会被篡改。同时也立于以后的审计工作。高可用性不会存在如目前的中心服务或者中心存储系统受到攻击或其他问题而发生合约不执行的问题。其实综合来说,区块链给予智能合约最好的特性就是“信任机制。</p>
<p>目前来说，智能合约同样也有很多的局限性。例如线下的问题解决起来还是无法与线上的问题相提并论的。如商品问题，给予的商品质量如何评估与上链，是否还需要依赖于第三方？ 同时智能合约的编写者对于合约的细节把控必须特别的严谨。一是合约漏洞，不严谨的合约造成对某个参与者的损失。二是可能会出现Bug，而如果bug被黑客所利用那么就会造成重大的损失。同样智能合约的法律问题也是要考虑的重点。</p>
<h1 id="以太坊"><a href="#以太坊" class="headerlink" title="以太坊"></a>以太坊</h1><p>以太坊（英文Ethereum）是一个开源的有智能合约功能的公共区块链平台，通过其专用加密货币以太币（Ether）提供去中心化的虚拟机（“以太虚拟机” Ethereum Virtual Machine）来处理点对点合约。</p>
<p>比特币并不完美，其中协议的扩展性是一项不足，例如比特币网络里只有一种符号——比特币，用户无法自定义另外的符号，这些符号可以是代表公司的股票，或者是债务凭证等，这就损失了一些功能。另外，比特币协议里使用了一套基于堆栈的脚本语言，这语言虽然具有一定灵活性，使得像多重签名这样的功能得以实现，然而却不足以构建更高级的应用，例如去中心化交易所等。以太坊从设计上就是为了解决比特币扩展性不足的问题。</p>
<p>以太坊是一个平台，它上面提供各种模块让用户来搭建应用。具体来说，以太坊通过一套图灵完备的脚本语言（EthereumVirtual Machinecode，简称EVM语言）来建立应用，它类似于汇编语言，但以太坊里的编程并不需要直接使用EVM语言，而是类似C语言、Python、Lisp等高级语言，再通过编译器转成EVM语言。</p>
<p>上面所说的平台之上的应用，其实就是合约，这是以太坊的核心。合约是一个活在以太坊系统里的自动代理人，他有一个自己的以太币地址，当用户向合约的地址里发送一笔交易后，该合约就被激活，然后根据交易中的额外信息，合约会运行自身的代码，最后返回一个结果，这个结果可能是从合约的地址发出另外一笔交易。需要指出的是，以太坊中的交易，不单只是发送以太币而已，它还可以嵌入相当多的额外信息。如果一笔交易是发送给合约的，那么这些信息就非常重要，因为合约将根据这些信息来完成自身的业务逻辑。合约所能提供的业务，几乎是无穷无尽的，它的边界就是你的想象力，因为图灵完备的语言提供了完整的自由度，让用户搭建各种应用。</p>
<p>比特币网络事实上是一套分布式的数据库，而以太坊则更进一步，她可以看作是一台分布式的计算机：区块链是计算机的ROM，合约是程序，而以太坊的矿工们则负责计算，担任CPU的角色。这台计算机不是、也不可能是免费使用的，不然任何人都可以往里面存储各种垃圾信息和执行各种鸡毛蒜皮的计算，使用它至少需要支付计算费和存储费，当然还有其它一些费用。</p>
<h1 id="分叉"><a href="#分叉" class="headerlink" title="分叉"></a>分叉</h1><p>比特币社区开发者一直在致力于改进比特币,但是不像传统软件的升级，一个分布式共识系统的升级是非常困难的，需要协调好所有的系统参与者。每次升级可能会伴随着区块链的共识规则改变，这会导致整个网络中升级了软件的节点与未升级软件的节点运行在不同的规则下，于是分叉就产生了。</p>
<h2 id="硬分叉"><a href="#硬分叉" class="headerlink" title="硬分叉"></a>硬分叉</h2><p>如果区块链软件的共识规则被改变，并且这种规则改变无法向前兼容，旧节点无法认可新节点产生的区块，即为硬分叉。这时候旧节点会拒绝新规则的区块，于是新节点和旧节点会开始在不同的区块链上运行（挖矿、交易、验证等），由于新旧节点可能长期存在，这种分叉也可能会长期持续下去。</p>
<h2 id="软分叉"><a href="#软分叉" class="headerlink" title="软分叉"></a>软分叉</h2><p>如果区块链的共识规则改变后，这种改变是向前兼容的，旧节点可以兼容新节点产生的区块，即为软分叉。实际上，软分叉通常刚开始并不会产生两条区块链，因为新规则下产生的块会被旧节点接受，旧节点只是无法识别新规则的真实意义。所以新旧节点仍然处于同一条区块链上，对整个系统的影响也就较小。</p>
<h1 id="共识算法"><a href="#共识算法" class="headerlink" title="共识算法"></a>共识算法</h1><h2 id="PoW"><a href="#PoW" class="headerlink" title="PoW"></a>PoW</h2><p>POW（Proof of Work）：工作量证明，即你能够获得的币的数量，取决于你挖矿贡献的有效工作，也就是说，你用于挖矿的矿机的性能越好，分给你的收益就会越多，这就是根据你的工作证明来执行币的分配方式。通俗的说，PoW 的意思就是社会主义，按劳分配，多劳多得。</p>
<p>PoW 的优势与劣势：</p>
<ul>
<li>PoW机制的设计目的是保证安全。无论是在中心化还是非中心化系统中，防止作弊都是很重要的。</li>
<li>PoW 假设大多数人不会作弊，如果你想作弊，你要有压倒大多数人的算力（51%攻击），但不能防止矿工抱团取暖。</li>
</ul>
<h2 id="PoS"><a href="#PoS" class="headerlink" title="PoS"></a>PoS</h2><p>PoS（Proof of Stake）：权益证明，类似比特币这样的 PoW 币种挖矿带来了巨大的电力能源消耗，为了解决这种情况，所以有了 PoS。PoS 试图解决 PoW 机制中大量资源被浪费的情况。这种机制通过计算你持有占总币数的百分比以及占有币数的时间来决定记账权。在现实世界中 PoS 很普遍，最为熟知的例子就是股票。股票是用来记录股权的证明，股票持有量多的，拥有更高更多的投票权和收益权。通俗的说，PoS 就是资本主义，按钱分配，钱生钱。</p>
<ul>
<li>Proof of Deposit：这次挖到矿的旷工投入的币会锁定一段时间才能接着投入。如果有分叉的话锁定的币只会在当前分支起锁定效果。</li>
</ul>
<p>PoS 的优势与劣势：</p>
<ul>
<li>Pos 当然也能防作弊，因为如果一名持有 51%以上股权的人作弊，相当于他坑了自己，因为一个人自己不会杀死自己的钱。</li>
<li>PoS 机制由股东自己保证安全，工作原理是利益捆绑。在这个模式下，不持有 PoS 的人无法对 PoS 构成威胁。PoS 的安全取决于持有者，和其他任何因素无关。</li>
</ul>
<h2 id="DPoS"><a href="#DPoS" class="headerlink" title="DPoS"></a>DPoS</h2><h3 id="算法概述"><a href="#算法概述" class="headerlink" title="算法概述"></a>算法概述</h3><p>DPoS（Delegated Proof of Stake）：委托股权证明，是 PoS 的进化方案，由 Dan Larimer 发明。（例子：比特股 BTS）</p>
<p>在常规 PoW 和 PoS 中，一大影响效率之处在于任何一个新加入的 Block，都需要被整个网络所有节点做确认。DPoS 优化方案在于：通过不同的策略，不定时的选中一小群节点，这一小群节点做新区块的创建，验证，签名和相互监督，这样就大幅度的减少了区块创建和确认所需要消耗的时间和算力成本。</p>
<p>DPOS算法分为两部分：选择一组块生产者和调度生产。选举过程确保利益相关方最终得到控制，因为当网络不能顺利运行时，利益相关方的损失最大。选举方法对实际运行中如何达成共识几乎没有影响，因此主要介绍如何在块生产者被选择之后达成共识。</p>
<p>假设3个块生产者A，B和C。因为共识（的达成）需要2/3+1多数来解决所有情况，这个简化的模型将假设生产者C是打破僵局的那个人。在现实世界中，将有21个或更多的块生产者。像工作量证明一样，一般规则是最长链胜出。任何时候当一个诚实的对等节点看到一个有效的更长链，它都会从当前分叉切换到更长的这条链。</p>
<h3 id="正常操作"><a href="#正常操作" class="headerlink" title="正常操作"></a>正常操作</h3><p>在正常操作模式下，块生产者每3秒钟轮流生成一个块。假设没有人错过自己的轮次，那么这将产生最长链。块生产者在被调度轮次之外的任何时间段出块都是无效的。</p>
<h3 id="少数分叉"><a href="#少数分叉" class="headerlink" title="少数分叉"></a>少数分叉</h3><p>不超过节点总数三分之一的恶意或故障节点可能创建少数分叉。在这种情况下，少数分叉每9秒只能产生一个块，而多数分叉每9秒可以产生两个块。这样，诚实的2/3多数将永远比少数（的链）更长。</p>
<h3 id="离线少数的多重生产"><a href="#离线少数的多重生产" class="headerlink" title="离线少数的多重生产"></a>离线少数的多重生产</h3><p>（离线的）少数人可以试图产生无限数量的分叉，但是他们的所有分叉都将比多数人的那条链短，因为少数人在出块速度上注定比多数人来的更慢。</p>
<h3 id="网络碎片化"><a href="#网络碎片化" class="headerlink" title="网络碎片化"></a>网络碎片化</h3><p>网络完全有可能碎片化，导致没有任何分叉拥有多数块生成者。在这种情况下，最长的链将倒向最大的那个少数群体。当网络连通性恢复时，较小的少数群体会自然切换到最长的那条链，明确的共识将恢复。</p>
<p>有可能存在这样三个分叉，其中两个最长的分叉长度相同。在这种情况下，第3个（较小）分叉的块生产者重新加入网络时会打破平局。块生产者总数为奇数，因此不可能长时间保持平局。稍后我们还会讲到生产者“洗牌”，它使得出块顺序随机化，从而确保即使是生产者数目相同的两个分叉也会以不同的步长增长，最终导致一个分叉超过另一个。</p>
<h3 id="在线少数的多重生产"><a href="#在线少数的多重生产" class="headerlink" title="在线少数的多重生产"></a>在线少数的多重生产</h3><p>在这种场景下，少数节点B在其时间段内产生了两个或更多可供选择的块。下一个计划生产者（C）可以选择基于B产生的任何一种方案继续构建链条。一旦如此，这个选择就成为最长的链，而所有选择B1的节点都将切换分叉。少数不良生产者企图广播再多的替代块也无关紧要，它们作为最长链的一部分永远不会超过一轮。</p>
<h3 id="最后不可逆块"><a href="#最后不可逆块" class="headerlink" title="最后不可逆块"></a>最后不可逆块</h3><p>在网络碎片化的情况下，多个分叉都有可能持续不断增长相当长的时间。长远来看最长的链终将获胜，但观察者需要一种确切的手段来判定一个块是否绝对处于增长最快的那条链。这可以通过观察来自2/3+1多数块生产者的确认来决定。</p>
<h3 id="多数生产者舞弊"><a href="#多数生产者舞弊" class="headerlink" title="多数生产者舞弊"></a>多数生产者舞弊</h3><p>如果多数生产者变得腐败，那么他们可以产生无限数量的分叉，每个分叉都看起来以2/3多数确认向前走。这种情况下，最后不可逆块算法蜕变为最长链算法。最长链就是为最大多数所批准的那条链，而这将由少数剩下的诚实节点决定。这种行为不会持续很长时间，因为利益相关方最终会投票替换生产者。</p>
<h3 id="确定性生产者洗牌"><a href="#确定性生产者洗牌" class="headerlink" title="确定性生产者洗牌"></a>确定性生产者洗牌</h3><p>在上面所有例子中，我们展示的都是块生产者按循环调度出块。实际上，每出N个块（N是生产者数量），块生产者集合都会洗牌一次。这种随机性确保块生成者B不会总是忽略块生成者A，每当形成多个拥有相同数量生产者的分叉时，平局最终都会被打破。</p>
<h3 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h3><p>在每一个我们能想到的自然网络分裂的情况下，委托权益证明都是强健的，甚至在面对相当数量生产者舞弊的情形时也是安全的。不像其它共识算法，当大多数生产者不合格时，DPOS还是可以继续工作。在此过程中，社区可以投票替换掉不合格的生产者，直到恢复100％参与率。</p>
<p>说到底，DPOS引人注目的安全性来自于其选择块生产者和验证节点质量的算法。运用赞成投票的过程可以确保一个人即使拥有50％的有效投票权也不能独自挑选哪怕一个生产者。DPOS旨在优化拥有强壮网络连接的诚实节点100％参与（共识过程）的名义条件。这使得DPOS有能力在平均只有1.5秒的时间内以99.9％的确定性确认交易，同时以优雅和可检测的方式降级 – 从降级中恢复正常也不过是小事一桩。</p>
<h2 id="PoW-PoS-混合机制"><a href="#PoW-PoS-混合机制" class="headerlink" title="PoW + PoS 混合机制"></a>PoW + PoS 混合机制</h2><p>为了结合两种挖矿方式的优点，开始有了基于 PoW+PoS 混合共识机制的币。例如 Hcash，以及以太坊 ETH 也正在向 PoW+PoS 混合挖升级矿转变。</p>
<p>PoW + PoS 混合机制的优势：</p>
<ul>
<li>假设一个币它的机制是PoW + PoS 的混合机制。那么持有该币的用户与矿工均可以参与到投票中，共同参与该币社区的重大决定，持币者与矿工都可以影响预先编制好的更新，如隔离见证（SegWit）、增大区块等等。如果这些更新被广泛认可，无需开发者干预，链就会自动分叉以配合更新。而这才是真正的去中心化。</li>
<li>以混合机制来实现广义上的 DAO（去中心化自治组织）的高效运行。通过 PoW+PoS 公平的按持币数量与工作量分配投票权重，实现社区自治。</li>
</ul>
<h2 id="DAG"><a href="#DAG" class="headerlink" title="DAG"></a>DAG</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>DAG：Directed Acyclic Graph，即“有向无环图”。区块链是每个区块记多笔交易，而DAG是每个区块存一笔交易，所以它们的本质相同。在IOTA白皮书里，把结扎在一起的交易称为缠结（Tangle）。</p>
<p>使用者每发起一笔交易，必须验证之前的两笔交易。如果一笔交易不被后来的交易所验证，它就会在账本里失去合法性。交易发起者自己选择两笔合法交易，花2秒钟找出一个随机数，让“随机数+信息”的哈希值符合系统要求。</p>
<p>验证所需的工作量与前手交易权重成正比，交易权重相当于验证难度，难度越高验证时间越长。IOTA中，权重是以3为底的指数增长：3的1次方、3的2次方、3的3次方……被验证次数越多的交易权重越大。所以，不用担心验证完两笔正确交易却没人来验证你，因为验证新鲜交易更容易，如果验证靠前的陈旧交易，工作量会指数级地翻上去.</p>
<p>如果只往前验证一笔，网络会被大算力操控。算力强者很容易抬高交易权重，拉长尾巴，以堵死后面的验证通路，让随后的诚实交易不得不屈从大算力；可验太多交易又会耗时过长。所以，验两笔能兼顾安全和效率。</p>
<p>于是，发起者一边提交自己的交易，一边验证别人的交易，以此编织着一个去中心化网络。</p>
<h3 id="DAG保证账本安全"><a href="#DAG保证账本安全" class="headerlink" title="DAG保证账本安全"></a>DAG保证账本安全</h3><p>假如A转给B价值100万元的IOTA，B确认后把100万元货物交给A，A靠算力发起攻击，用一笔权重更大的交易验证合法交易之前的交易。只要超过主体诚实的DAG，随后的交易都会接在A的DAG后面生长，这样就赖掉之前的交易，白白从B手里拿走100万元的货。此时需要汇聚34%才能实现双重支付？</p>
<p>IOTA团队说，网络还没成熟，所以先找了个协管员看场子，这名协管员就是一台名叫Coordinator的服务器。所有交易是否合法，暂时全由这位协管员拍板，拍板后告诉其他节点，该验证哪些交易。</p>
<p>影响账本安全的另一个因素是数字签名，因为攻击者无法使用他们没有的私钥签出和你一样的数字签名，而保障这件事的是哈希算法.IOTA使用了自己开发的哈希算法curl，但是curl算法的哈希值极易发生碰撞，于是就能伪造数字签名。</p>
<p>IOTA的DAG是靠后手保护前手，一旦攻击者成功伪造数字签名，后手挑不出伪造者的错，非法交易就能大摇大摆地通过验证，这意味着别人用其他私钥也能撬走你账户里的钱。现在IOTA有协管员保护，但如果撤下协管员，签名能否会被仿冒，就完全得寄希望于攻击者没有哈希出和你一样的签名。而协管员自己也有私钥，一旦泄露，造成的结果将比服务器电源插座被拔还要严重，因为此时持有私钥者具备改动任意交易的技术可能，这就是集中管账的风险。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>DAG是一种数据存储结构，从它被发明的30多年来一直都有人使用，本身并没有问题。但它和区块链的区别在于DAG没有传统意义上的共识，每笔交易的可信与否取决于相信这笔交易的人数。所以采用DAG技术的核心问题在于如何保护全网达成的一致.</p>
<p>IOTA使用了中心化方案：先协管员看护，以后慢慢放开。同样采用DAG的另一种加密货币Byteball就很淳朴，12名矿工通过收交易手续费的方式保护系统安全。</p>
<p>DAG曾经作为比特币扩容的方案，但最终没被采用，因为基于DAG的分布式网络在保护共识方面很难比区块更有效。</p>
<h2 id="HashNet"><a href="#HashNet" class="headerlink" title="HashNet"></a>HashNet</h2><img src="HashNet共识机制.webp"/>

<p>HashNet采用分层分片共识机制, 上层网络中的节点称为全节点（full node），主要负责下层分片建立、下层分片重组、新局部全节点加入、局部全节点退出，不参与全局共识，也不参与记账，这避免了形成性能瓶颈的风险，极大的提高了交易吞吐量。下层网络中的节点称为局部全节点（local full node），形成各个分片，片内进行交易达成共识，采用后缀匹配法确保每笔交易只由一个特定的分片处理，避免了双重支付，同时片间通过异步机制同步各个片内的共识结果，从而达到每个局部全节点拥有全局账本。</p>
<p>HashNet共识机制的主要优势在于：</p>
<ol>
<li>全节点和局部全节点具有较强的稳定性和处理能力，能够有效避免HashGraph长时间无法达成共识的问题，也能够避免因网络被分割造成的恶意节点攻击问题；</li>
<li>与当前其他带分片的区块链项目相比，HashNet采用分布式异步分片重组，完全打破了集中式分片重组的机制，极大地提高了重组时的安全性；</li>
<li>交易共识不需要上层节点参与，交易达成速度极快（交易确认时间仅仅依赖于片内节点数量），更重要的是，交易吞吐量，即TPS，与下层分片数量成正比，即分片数量越多，TPS越高；</li>
<li>片内和片间节点均为对等，没有所谓的Leader，避免了潜在的中心化可能和性能瓶颈。</li>
</ol>
<h1 id="区块链项目"><a href="#区块链项目" class="headerlink" title="区块链项目"></a>区块链项目</h1><img src="区块链项目分类.JPEG"/>

<h1 id="实践一-创建区块链"><a href="#实践一-创建区块链" class="headerlink" title="实践一-创建区块链"></a>实践一-创建区块链</h1><p><a target="_blank" rel="noopener" href="https://github.com/ljd1996/blockchain_go/tree/part_1">https://github.com/ljd1996/blockchain_go/tree/part_1</a></p>
<h2 id="创建Block"><a href="#创建Block" class="headerlink" title="创建Block"></a>创建Block</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> code</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;crypto/sha256&quot;</span></span><br><span class="line">    <span class="string">&quot;encoding/hex&quot;</span></span><br><span class="line">    <span class="string">&quot;time&quot;</span></span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Block <span class="keyword">struct</span> &#123;</span><br><span class="line">    Index        <span class="keyword">int64</span>  <span class="comment">// 区块编号</span></span><br><span class="line">    Timestamp    <span class="keyword">int64</span>  <span class="comment">// 区块时间戳</span></span><br><span class="line">    PreBlockHash <span class="keyword">string</span> <span class="comment">// 上一个区块Hash值</span></span><br><span class="line">    Hash         <span class="keyword">string</span> <span class="comment">// 当前区块Hash值</span></span><br><span class="line">    Data         <span class="keyword">string</span> <span class="comment">//区块数据</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(block *Block)</span> <span class="title">Print</span><span class="params">()</span></span>  &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;Index: %d\n&quot;</span>, block.Index)</span><br><span class="line">    fmt.Printf(<span class="string">&quot;PreHash: %s\n&quot;</span>, block.PreBlockHash)</span><br><span class="line">    fmt.Printf(<span class="string">&quot;CurHash: %s\n&quot;</span>, block.Hash)</span><br><span class="line">    fmt.Printf(<span class="string">&quot;Data: %s\n&quot;</span>, block.Data)</span><br><span class="line">    fmt.Printf(<span class="string">&quot;Timestamp: %d\n&quot;</span>, block.Timestamp)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 计算Hash值 */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">calculateHash</span><span class="params">(b Block)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    blockData := <span class="keyword">string</span>(b.Index) + <span class="keyword">string</span>(b.Timestamp) + <span class="keyword">string</span>(b.PreBlockHash) + <span class="keyword">string</span>(b.Data)</span><br><span class="line">    hashByte := sha256.Sum256([]<span class="keyword">byte</span>(blockData))</span><br><span class="line">    <span class="keyword">return</span> hex.EncodeToString(hashByte[:])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 生成下一个区块 */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GenNewBlock</span><span class="params">(preBlock Block, data <span class="keyword">string</span>)</span> <span class="title">Block</span></span> &#123;</span><br><span class="line">    newBlock := Block&#123;&#125;</span><br><span class="line">    newBlock.Index = preBlock.Index + <span class="number">1</span></span><br><span class="line">    newBlock.Timestamp = time.Now().Unix()</span><br><span class="line">    newBlock.PreBlockHash = preBlock.Hash</span><br><span class="line">    newBlock.Data = data</span><br><span class="line">    newBlock.Hash = calculateHash(newBlock)</span><br><span class="line">    <span class="keyword">return</span> newBlock</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 生成创始区块 */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GenGenesisBlock</span><span class="params">()</span> <span class="title">Block</span></span> &#123;</span><br><span class="line">    preBlock := Block&#123;&#125;</span><br><span class="line">    preBlock.Index = <span class="number">-1</span></span><br><span class="line">    preBlock.Hash = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> GenNewBlock(preBlock, <span class="string">&quot;Genesis Block&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="创建BlockChain"><a href="#创建BlockChain" class="headerlink" title="创建BlockChain"></a>创建BlockChain</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> code</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;log&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> BlockChain <span class="keyword">struct</span> &#123;</span><br><span class="line">    Blocks []*Block</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *BlockChain)</span> <span class="title">Print</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> _, block := <span class="keyword">range</span> bc.Blocks &#123;</span><br><span class="line">        block.Print()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *BlockChain)</span> <span class="title">SendData</span><span class="params">(data <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">    preBlock := bc.Blocks[<span class="built_in">len</span>(bc.Blocks)<span class="number">-1</span>]</span><br><span class="line">    newBlock := GenNewBlock(*preBlock, data)</span><br><span class="line">    bc.appendBlock(&amp;newBlock)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *BlockChain)</span> <span class="title">appendBlock</span><span class="params">(newBlock *Block)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(bc.Blocks) == <span class="number">0</span> &#123;</span><br><span class="line">        bc.Blocks = <span class="built_in">append</span>(bc.Blocks, newBlock)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> isValid(*newBlock, *bc.Blocks[<span class="built_in">len</span>(bc.Blocks)<span class="number">-1</span>]) &#123;</span><br><span class="line">        bc.Blocks = <span class="built_in">append</span>(bc.Blocks, newBlock)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        log.Print(<span class="string">&quot;invalid block!&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isValid</span><span class="params">(newBlock Block, oldBlock Block)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (newBlock.Index<span class="number">-1</span> == oldBlock.Index) &amp;&amp;</span><br><span class="line">        (newBlock.PreBlockHash == oldBlock.Hash) &amp;&amp;</span><br><span class="line">        (calculateHash(newBlock) == newBlock.Hash)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewBlockChain</span><span class="params">()</span> *<span class="title">BlockChain</span></span> &#123;</span><br><span class="line">    genesisBLock := GenGenesisBlock()</span><br><span class="line">    blockChain := BlockChain&#123;&#125;</span><br><span class="line">    blockChain.appendBlock(&amp;genesisBLock)</span><br><span class="line">    <span class="keyword">return</span> &amp;blockChain</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="实践二-工作量证明"><a href="#实践二-工作量证明" class="headerlink" title="实践二-工作量证明"></a>实践二-工作量证明</h1><p><a target="_blank" rel="noopener" href="https://github.com/ljd1996/blockchain_go/tree/part_2">https://github.com/ljd1996/blockchain_go/tree/part_2</a></p>
<h2 id="Block"><a href="#Block" class="headerlink" title="Block"></a>Block</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Block keeps block headers</span></span><br><span class="line"><span class="keyword">type</span> Block <span class="keyword">struct</span> &#123;</span><br><span class="line">	Timestamp     <span class="keyword">int64</span></span><br><span class="line">	Data          []<span class="keyword">byte</span></span><br><span class="line">	PrevBlockHash []<span class="keyword">byte</span></span><br><span class="line">	Hash          []<span class="keyword">byte</span></span><br><span class="line">	Nonce         <span class="keyword">int</span>   <span class="comment">// 跟工作量证明相关</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NewBlock creates and returns Block</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewBlock</span><span class="params">(data <span class="keyword">string</span>, prevBlockHash []<span class="keyword">byte</span>)</span> *<span class="title">Block</span></span> &#123;</span><br><span class="line">	block := &amp;Block&#123;time.Now().Unix(), []<span class="keyword">byte</span>(data), prevBlockHash, []<span class="keyword">byte</span>&#123;&#125;, <span class="number">0</span>&#125;</span><br><span class="line">	pow := NewProofOfWork(block)</span><br><span class="line">	nonce, hash := pow.Run()</span><br><span class="line"></span><br><span class="line">	block.Hash = hash[:]</span><br><span class="line">	block.Nonce = nonce</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> block</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NewGenesisBlock creates and returns genesis Block</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewGenesisBlock</span><span class="params">()</span> *<span class="title">Block</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> NewBlock(<span class="string">&quot;Genesis Block&quot;</span>, []<span class="keyword">byte</span>&#123;&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="BlockChain"><a href="#BlockChain" class="headerlink" title="BlockChain"></a>BlockChain</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="comment">// Blockchain keeps a sequence of Blocks</span></span><br><span class="line"><span class="keyword">type</span> Blockchain <span class="keyword">struct</span> &#123;</span><br><span class="line">	blocks []*Block</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// AddBlock saves provided data as a block in the blockchain</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bc *Blockchain)</span> <span class="title">AddBlock</span><span class="params">(data <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">	prevBlock := bc.blocks[<span class="built_in">len</span>(bc.blocks)<span class="number">-1</span>]</span><br><span class="line">	newBlock := NewBlock(data, prevBlock.Hash)</span><br><span class="line">	bc.blocks = <span class="built_in">append</span>(bc.blocks, newBlock)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NewBlockchain creates a new Blockchain with genesis Block</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewBlockchain</span><span class="params">()</span> *<span class="title">Blockchain</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;Blockchain&#123;[]*Block&#123;NewGenesisBlock()&#125;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ProofOfWork"><a href="#ProofOfWork" class="headerlink" title="ProofOfWork"></a>ProofOfWork</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;bytes&quot;</span></span><br><span class="line">	<span class="string">&quot;crypto/sha256&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;math&quot;</span></span><br><span class="line">	<span class="string">&quot;math/big&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">	maxNonce = math.MaxInt64</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> targetBits = <span class="number">24</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ProofOfWork represents a proof-of-work</span></span><br><span class="line"><span class="keyword">type</span> ProofOfWork <span class="keyword">struct</span> &#123;</span><br><span class="line">	block  *Block</span><br><span class="line">	target *big.Int</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NewProofOfWork builds and returns a ProofOfWork</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewProofOfWork</span><span class="params">(b *Block)</span> *<span class="title">ProofOfWork</span></span> &#123;</span><br><span class="line">	target := big.NewInt(<span class="number">1</span>)</span><br><span class="line">	target.Lsh(target, <span class="keyword">uint</span>(<span class="number">256</span>-targetBits))</span><br><span class="line"></span><br><span class="line">	pow := &amp;ProofOfWork&#123;b, target&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> pow</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(pow *ProofOfWork)</span> <span class="title">prepareData</span><span class="params">(nonce <span class="keyword">int</span>)</span> []<span class="title">byte</span></span> &#123;</span><br><span class="line">	data := bytes.Join(</span><br><span class="line">		[][]<span class="keyword">byte</span>&#123;</span><br><span class="line">			pow.block.PrevBlockHash,</span><br><span class="line">			pow.block.Data,</span><br><span class="line">			IntToHex(pow.block.Timestamp),</span><br><span class="line">			IntToHex(<span class="keyword">int64</span>(targetBits)),</span><br><span class="line">			IntToHex(<span class="keyword">int64</span>(nonce)),</span><br><span class="line">		&#125;,</span><br><span class="line">		[]<span class="keyword">byte</span>&#123;&#125;,</span><br><span class="line">	)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Run performs a proof-of-work</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(pow *ProofOfWork)</span> <span class="title">Run</span><span class="params">()</span> <span class="params">(<span class="keyword">int</span>, []<span class="keyword">byte</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> hashInt big.Int</span><br><span class="line">	<span class="keyword">var</span> hash [<span class="number">32</span>]<span class="keyword">byte</span></span><br><span class="line">	nonce := <span class="number">0</span></span><br><span class="line"></span><br><span class="line">	fmt.Printf(<span class="string">&quot;Mining the block containing \&quot;%s\&quot;\n&quot;</span>, pow.block.Data)</span><br><span class="line">	<span class="keyword">for</span> nonce &lt; maxNonce &#123;</span><br><span class="line">		data := pow.prepareData(nonce)</span><br><span class="line"></span><br><span class="line">		hash = sha256.Sum256(data)</span><br><span class="line">		fmt.Printf(<span class="string">&quot;\r%x&quot;</span>, hash)</span><br><span class="line">		hashInt.SetBytes(hash[:])</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> hashInt.Cmp(pow.target) == <span class="number">-1</span> &#123;</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			nonce++</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Print(<span class="string">&quot;\n\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> nonce, hash[:]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Validate validates block&#x27;s PoW</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(pow *ProofOfWork)</span> <span class="title">Validate</span><span class="params">()</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> hashInt big.Int</span><br><span class="line"></span><br><span class="line">	data := pow.prepareData(pow.block.Nonce)</span><br><span class="line">	hash := sha256.Sum256(data)</span><br><span class="line">	hashInt.SetBytes(hash[:])</span><br><span class="line"></span><br><span class="line">	isValid := hashInt.Cmp(pow.target) == <span class="number">-1</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> isValid</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="实践三-持久化-bolt"><a href="#实践三-持久化-bolt" class="headerlink" title="实践三-持久化(bolt)"></a>实践三-持久化(bolt)</h1><p><a target="_blank" rel="noopener" href="https://github.com/ljd1996/blockchain_go/tree/part_3">https://github.com/ljd1996/blockchain_go/tree/part_3</a></p>
<h1 id="实践四-交易"><a href="#实践四-交易" class="headerlink" title="实践四-交易"></a>实践四-交易</h1><p><a target="_blank" rel="noopener" href="https://github.com/ljd1996/blockchain_go/tree/part_4">https://github.com/ljd1996/blockchain_go/tree/part_4</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Block <span class="keyword">struct</span> &#123;</span><br><span class="line">	Timestamp     <span class="keyword">int64</span></span><br><span class="line">	Transactions  []*Transaction</span><br><span class="line">	PrevBlockHash []<span class="keyword">byte</span></span><br><span class="line">	Hash          []<span class="keyword">byte</span></span><br><span class="line">	Nonce         <span class="keyword">int</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Transaction represents a Bitcoin transaction</span></span><br><span class="line"><span class="keyword">type</span> Transaction <span class="keyword">struct</span> &#123;</span><br><span class="line">	ID   []<span class="keyword">byte</span></span><br><span class="line">	Vin  []TXInput</span><br><span class="line">	Vout []TXOutput</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TXInput represents a transaction input</span></span><br><span class="line"><span class="keyword">type</span> TXInput <span class="keyword">struct</span> &#123;</span><br><span class="line">	Txid      []<span class="keyword">byte</span></span><br><span class="line">	Vout      <span class="keyword">int</span></span><br><span class="line">	ScriptSig <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TXOutput represents a transaction output</span></span><br><span class="line"><span class="keyword">type</span> TXOutput <span class="keyword">struct</span> &#123;</span><br><span class="line">	Value        <span class="keyword">int</span></span><br><span class="line">	ScriptPubKey <span class="keyword">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="实践五-地址及身份标识"><a href="#实践五-地址及身份标识" class="headerlink" title="实践五-地址及身份标识"></a>实践五-地址及身份标识</h1><p><a target="_blank" rel="noopener" href="https://github.com/ljd1996/blockchain_go/tree/part_5">https://github.com/ljd1996/blockchain_go/tree/part_5</a></p>
<h1 id="实践六-钱包-交易-RPC"><a href="#实践六-钱包-交易-RPC" class="headerlink" title="实践六-钱包/交易/RPC"></a>实践六-钱包/交易/RPC</h1><p><a target="_blank" rel="noopener" href="https://github.com/ljd1996/blockchain_go/tree/part_6">https://github.com/ljd1996/blockchain_go/tree/part_6</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/ljd1996/blockchain_go/tree/part_7">https://github.com/ljd1996/blockchain_go/tree/part_7</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/ljd1996/blockchain_go/tree/master">https://github.com/ljd1996/blockchain_go/tree/master</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://ljd1996.github.io/2018/12/05/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="苍耳叔叔">
      <meta itemprop="description" content="梦里寻她千百度，蓦然回首，那人却在，灯火阑珊处。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="苍耳的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/12/05/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/" class="post-title-link" itemprop="url">计算机基础</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-12-05 16:43:01" itemprop="dateCreated datePublished" datetime="2018-12-05T16:43:01+08:00">2018-12-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-14 14:14:58" itemprop="dateModified" datetime="2021-05-14T14:14:58+08:00">2021-05-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/" itemprop="url" rel="index"><span itemprop="name">计算机</span></a>
                </span>
            </span>

          
            <span id="/2018/12/05/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/" class="post-meta-item leancloud_visitors" data-flag-title="计算机基础" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2018/12/05/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2018/12/05/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="图灵"><a href="#图灵" class="headerlink" title="图灵"></a>图灵</h1><h2 id="图灵-1"><a href="#图灵-1" class="headerlink" title="图灵"></a>图灵</h2><p>艾伦·麦席森·图灵（Alan Mathison Turing，1912年6月23日－1954年6月7日），英国数学家、逻辑学家，被称为计算机科学之父，人工智能之父。</p>
<h2 id="图灵机"><a href="#图灵机" class="headerlink" title="图灵机"></a>图灵机</h2><p>停机问题通俗地说，停机问题就是判断任意一个程序是否能在有限的时间之内结束运行的问题。该问题等价于如下的判定问题：是否存在一个程序P，对于任意输入的程序w，能够判断w会在有限时间内结束或者死循环。有人猜测图灵机模型是图灵在思考停机问题而顺带设计出来的.</p>
<img src="图灵机的组成.webp"/>

<p>图灵的基本思想是用机器来模拟人们用纸笔进行数学运算的过程，它运算过程看作下列两种简单的动作：</p>
<ul>
<li>在纸上写上或擦除某个符号；</li>
<li>把注意力从纸的一个位置移动到另一个位置；</li>
</ul>
<p>逻辑结构上图灵机有四个部分组成:</p>
<ul>
<li>一个无限长的存储带，带子有一个个连续的存储格子组成，每个格子可以存储一个数字或符号</li>
<li>一个读写头，读写头可以在存储带上左右移动，并可以读、修改存储格上的数字或符号</li>
<li>内部状态存储器，该存储器可以记录图灵机的当前状态，并且有一种特殊状态为停机状态</li>
<li>控制程序指令，指令可以根据当前状态以及当前读写头所指的格子上的符号来确定读写头下一步的动作（左移还是右移），并改变状态存储器的值，令机器进入一个新的状态或保持状态不变。</li>
</ul>
<h2 id="图灵完备"><a href="#图灵完备" class="headerlink" title="图灵完备"></a>图灵完备</h2><p>可图灵指在可计算性理论中，编程语言或任意其他的逻辑系统如具有等用于通用图灵机的计算能力。换言之，此系统可与通用图灵机互相模拟。</p>
<p>简单来说，能够抽象成图灵机的系统或编程语言就是图灵完备的；一切可计算的问题图灵机都能计算，因此满足这样要求的逻辑系统、装置或者编程语言就叫图灵完备的。</p>
<p>在可计算性理论里，如果一系列操作数据的规则（如指令集、编程语言、细胞自动机）按照一定的顺序可以计算出结果，被称为图灵完备（turing complete）。</p>
<p>一个有图灵完备指令集的设备被定义为通用计算机。如果是图灵完备的，它（计算机设备）有能力执行条件跳转（if、while、goto语句）以及改变内存数据。如果某个东西展现出了图灵完备，它就有能力表现出可以模拟原始计算机，而即使最简单的计算机也能模拟出最复杂的计算机。所有的通用编程语言和现代计算机的指令集都是图灵完备的（C++ template就是图灵完备的），都能解决内存有限的问题。图灵完备的机器都被定义有无限内存，但是机器指令集却通常定义为只工作在特定的、有限数量的RAM上。</p>
<p>图灵完备的语言，有循环执行语句，判断分支语句等。理论上能解决任何算法。但有可能进入死循环而程序崩溃。</p>
<p>图灵不完备也不是没有意义，有些场景我们需要限制语言本身。如限制循环和递归, 可以保证该语言能写的程序一定是终止的。</p>
<p>比特币的脚本系统是图灵不完备的，以太坊的智能合约系统是图灵完备的。各有优缺点，图灵不完备会更安全些，图灵完备会更智能些。</p>
<h1 id="IO模型"><a href="#IO模型" class="headerlink" title="IO模型"></a>IO模型</h1><p>IO可以理解为对流的操作，当一个read操作发生时，它会经历两个阶段：</p>
<ol>
<li>等待数据准备。</li>
<li>将数据从内核拷贝到进程中</li>
</ol>
<h2 id="同步阻塞IO"><a href="#同步阻塞IO" class="headerlink" title="同步阻塞IO"></a>同步阻塞IO</h2><img src="同步阻塞IO.png"/>

<p>用户线程通过系统调用read发起IO读操作，由用户空间转到内核空间。内核等到数据包到达后，然后将接收的数据拷贝到用户空间，完成read操作。</p>
<h2 id="同步非阻塞IO"><a href="#同步非阻塞IO" class="headerlink" title="同步非阻塞IO"></a>同步非阻塞IO</h2><img src="同步非阻塞IO.png"/>

<p>由于socket是非阻塞的方式，因此用户线程发起IO请求时立即返回。但并未读取到任何数据，用户线程需要不断地发起IO请求，直到数据到达后，才真正读取到数据，继续执行。</p>
<p>即用户需要不断地调用read，尝试读取socket中的数据，直到读取成功后，才继续处理接收的数据。整个IO请求的过程中，虽然用户线程每次发起IO请求后可以立即返回，但是为了等到数据，仍需要不断地轮询、重复请求，消耗了大量的CPU的资源。一般很少直接使用这种模型，而是在其他IO模型中使用非阻塞IO这一特性。</p>
<h2 id="IO多路复用"><a href="#IO多路复用" class="headerlink" title="IO多路复用"></a>IO多路复用</h2><img src="IO多路复用.png"/>

<p>IO多路复用模型是建立在内核提供的多路分离函数select基础之上的，使用select函数可以避免同步非阻塞IO模型中轮询等待的问题。</p>
<p>用户首先将需要进行IO操作的socket添加到select中，然后阻塞等待select系统调用返回。当数据到达时，socket被激活，select函数返回。用户线程正式发起read请求，读取数据并继续执行。</p>
<p>从流程上来看，使用select函数进行IO请求和同步阻塞模型没有太大的区别，甚至还多了添加监视socket，以及调用select函数的额外操作，效率更差。但是，使用select以后最大的优势是用户可以在一个线程内同时处理多个socket的IO请求。用户可以注册多个socket，然后不断地调用select读取被激活的socket，即可达到<font color="#FF0000">在同一个线程内同时处理多个IO请求的目的</font>。而在同步阻塞模型中，必须通过多线程的方式才能达到这个目的。</p>
<h2 id="异步IO"><a href="#异步IO" class="headerlink" title="异步IO"></a>异步IO</h2><img src="异步IO.png"/>

<p>“真正”的异步IO需要操作系统更强的支持。在IO多路复用模型中，事件循环将文件句柄的状态事件通知给用户线程，由用户线程自行读取数据、处理数据。而在异步IO模型中，当用户线程收到通知时，数据已经被内核读取完毕，并放在了用户线程指定的缓冲区内，内核在IO完成后通知用户线程直接使用即可。</p>
<h1 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h1><p>闭包的本质源自两点，<strong>词法作用域和函数当作值传递</strong>。</p>
<ul>
<li>词法作用域就是按照代码书写时的样子，内部函数可以访问函数外面的变量。</li>
<li>函数当作值传递，就是可以把函数当作一个值来赋值，当作参数传给别的函数，也可以把函数当作一个值 return。一个函数被当作值返回时，也就相当于返回了一个通道，这个通道可以访问这个函数词法作用域中的变量，即函数所需要的数据结构保存了下来，数据结构中的值在外层函数执行时创建，外层函数执行完毕时理因销毁，但由于内部函数作为值返回出去，这些值得以保存下来。而且无法直接访问，必须通过返回的函数。这也就是私有性。本来执行过程和词法作用域是封闭的，这种返回的函数就好比是一个虫洞。</li>
</ul>
<p>显然，闭包的形成很简单，在执行过程完毕后，返回函数，或者将函数得以保留下来，即形成闭包。</p>
<p>闭包可以理解成：一个持有外部环境变量的函数就是闭包。理解闭包通常有着以下几个关键点：</p>
<ol>
<li>函数</li>
<li>自由变量</li>
<li>环境</li>
</ol>
<p>举例如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(x, y) <span class="comment">//在这里，x和y都不是自由变量</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(x, y) <span class="comment">//但在这个内部函数b中，x和y相对于b都是自由变量，而函数a的作用域则是环境。</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//无论b最终是否会作为返回值被函数a返回，b本身都已经形成了闭包。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>“闭”的意思不是封闭内部状态，而是封闭外部状态，当外部状态的scope失效的时候，还有一份保留在内部状态里，就是所说的封闭外部状态。</p>
<p>知乎有个回答：我叫独孤求败，我在一个山洞里，里面有世界上最好的剑法，还有最好的武器。我学习了里面的剑法，拿走了最好的剑。离开了这里。我来到这个江湖，快意恩仇。但是从来没有人知道我这把剑的来历，和我这一身的武功。那山洞就是一个闭包，而我，就是那个山洞里唯一一个可以与外界交汇的地方。这山洞的一切对外人而言就像不存在一样，只有我才拥有这里面的宝藏！</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://ljd1996.github.io/2018/12/01/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="苍耳叔叔">
      <meta itemprop="description" content="梦里寻她千百度，蓦然回首，那人却在，灯火阑珊处。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="苍耳的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/12/01/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">区块链学习笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-12-01 20:10:28" itemprop="dateCreated datePublished" datetime="2018-12-01T20:10:28+08:00">2018-12-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-14 14:14:57" itemprop="dateModified" datetime="2021-05-14T14:14:57+08:00">2021-05-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/" itemprop="url" rel="index"><span itemprop="name">区块链</span></a>
                </span>
            </span>

          
            <span id="/2018/12/01/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="post-meta-item leancloud_visitors" data-flag-title="区块链学习笔记" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2018/12/01/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2018/12/01/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="名词及概念"><a href="#名词及概念" class="headerlink" title="名词及概念"></a>名词及概念</h1><ul>
<li>Coinbase transcation</li>
<li>1 BTC(比特币) = 100 cBTC(比特分) = 1000 mBTC(毫比特) = 1000000 uBTC(微比特) = 1E8(100000000)聪</li>
<li>Genesis block:第一个区块(有特殊hash值)</li>
<li>mining,miner,nonce</li>
<li>selfish mining:恶意节点挖到区块后不发布,而是等到积累一定数量的区块后再一次性发布,用来防止six confirmation(需要恶意节点数超过50%)</li>
<li>比特币 translation-based ledger</li>
<li>以太坊 account-based ledger</li>
<li>比特币中缺省six confirmation:防止恶意节点攻击(区块链增加一个区块后,后续要等待五个区块的添加)</li>
<li>比特币：double spending attack(付款人)；以太坊：replay attack(收款人)</li>
<li>bounty：赏金</li>
<li>区块链的安全性：所有的全节点要独立验证发布的区块</li>
<li>zhenxiao.com/</li>
<li>最初每个区块可以产生50枚比特币奖励，在每21万个区块后(每21万个区块约4年时间)，每个区块的奖励减半（现在每个区块可以奖励12.5枚比特币）,所以比特币共有2100万个，到2140年，比特币将无法细分。</li>
<li>安全性保证:密码学以及共识机制</li>
<li>密码朋克（cypherpunk）：结合了电脑朋克的思想，在电脑化空间下的个体精神，使用强加密（密文）保护个人隐私。</li>
<li>比特币水龙头网站：给访问网站的每个人分发小额比特币奖励，达到引流作用。</li>
<li>每个钱包都是一个节点，其中拥有完整区块链账本的节点叫做全节点，只拥有根hash值和一些信息的叫轻节点。</li>
<li>算力（也称哈希率）是比特币网络处理能力的度量单位。即为计算机（CPU）计算哈希函数输出的速度。一个挖矿机每秒钟能做多少次hash碰撞，就是其“算力”的代表，单位写成hash/s。</li>
<li>零知识证明:证明者能够在不向验证者提供信息本身内容的情况下,使验证者相信某个论断是真实可信的一种技术.可以在不泄漏信息本身内容的情况下,证明拥有某个秘密.</li>
<li>重放攻击:在比特币硬分叉后，新链与原链拥有相同的交易数据、地址、私钥、交易方式。在硬分叉之前的一种币，会因为分叉而变成两种,即可得到等额的新币.同时,在一种币上进行的交易,也可以广播到另一种币上.</li>
</ul>
<h1 id="比特币"><a href="#比特币" class="headerlink" title="比特币"></a>比特币</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>交易流程：</p>
<ol>
<li>有一个新的交易，要向全网公布广播。</li>
<li>每一个节点，都要将收集到的交易信息，放入一个区块中。</li>
<li>每一个节点都要试着在自己的区块中，找到一个足够难的工作量证明。</li>
<li>当一个节点找到了自己的工作量证明，都要对全网进行公布广播。</li>
<li>当且仅当这个区块中的所有交易是有效且之前从未有过，其他的节点才承认这个交易过程的有效性。</li>
<li>其他节点表示承认这个区块，表示认可的方法就是，根据这个区块的编码，往后延长这个链接。</li>
</ol>
<p>UTXO可以看做是一个比特币驱动的状态机。</p>
<h2 id="密码学原理"><a href="#密码学原理" class="headerlink" title="密码学原理"></a>密码学原理</h2><h2 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h2><h3 id="Hash-Pointer"><a href="#Hash-Pointer" class="headerlink" title="Hash Pointer"></a>Hash Pointer</h3><h3 id="Merkle-Tree"><a href="#Merkle-Tree" class="headerlink" title="Merkle Tree"></a>Merkle Tree</h3><ul>
<li>block header：包含某个区块所包含的所有交易组成的Merkle Tree组成的根Hash值，但是没有交易的具体内容。</li>
<li>block body：包含交易的列表和内容</li>
<li>全节点：包含header和body</li>
<li>轻节点：只包含header</li>
</ul>
<img src="Merkle Tree.png"/>

<p><code>Merkle Proof</code>/<code>Proof of membership</code>/<code>Proof of inclusion</code>：</p>
<ul>
<li>证明数据(交易)是否归属于此merkle树。</li>
<li>在不需要存储整个数据的情况下，就可以简明地证明数据是否属于资料组的一部分。</li>
<li>验证某些数据组是包含在更大的数据组中，而无须显示整个数据组或其子资料组。</li>
</ul>
<p><code>Proof of non-membership</code></p>
<ul>
<li>sorted merkle tree</li>
</ul>
<img src="全节点.png"/>

<img src="轻节点.png"/>

<h2 id="共识协议"><a href="#共识协议" class="headerlink" title="共识协议"></a>共识协议</h2><p>账本的内容要取得分布式的共识.</p>
<p>普通投票法:</p>
<ul>
<li>少数服从多数:恶意节点可以生成许多帐号投票,直到超过阈值(没有决定是否有投票权,简单的直接投票不行).</li>
</ul>
<p>最长链投票法:</p>
<ul>
<li>分叉攻击:选择最长链</li>
<li>两个节点同时记账成功(等长分叉):两个区块会保留一段时间,直到其中某个区块找到下一个区块.</li>
</ul>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p>用户把交易发布到区块链网络上,节点把这些交易打包成区块,然后添加到区块链中.</p>
<img src="BlockHeader字段.jpeg"/>

<p>可以通过修改Coinbase交易中的Coinbase字段来修改MarkleRoot的hash值，Coinbase tx中保存有旷工的地址，BlockHeader中保存有Nonce。</p>
<img src=""/>

<h2 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h2><h2 id="挖矿"><a href="#挖矿" class="headerlink" title="挖矿"></a>挖矿</h2><p>挖矿设备:</p>
<ul>
<li>CPU-&gt;GPU-&gt;ASIC(Application Specific Integranted Circle)-&gt;矿池</li>
</ul>
<p>矿池:</p>
<ul>
<li>一个pool manager(打包等计算hash之外的工作)和许多miner(只负责计算hash)</li>
<li>可以用almost valid block(不可用)来计算每个miner的工作量.</li>
</ul>
<h2 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h2><p>比特币使用的脚本语言特别简单，基于堆栈。</p>
<img src="比特币交易结构.png"/>

<img src="比特币交易输入结构.png"/>

<img src="比特币交易输出结构.png"/>

<img src="比特币交易过程.png"/>

<h2 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h2><ul>
<li>“区块恋”：把一个私钥分成两部分，一人持有一份，会降低安全性，破解私钥难度变低。</li>
<li>使用多重签名(multisig)的方式让多个合伙人拥有同一个钱包。</li>
<li>分布式共识：理论上被证明不可能(共识一旦达成就不可修改)。</li>
</ul>
<h1 id="以太坊"><a href="#以太坊" class="headerlink" title="以太坊"></a>以太坊</h1><h2 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h2><p>可以把以太坊看做一个交易驱动的状态机(transaction-driven state machine)。以太坊（Ethereum）是一个建立在区块链技术之上，去中心化应用平台，它允许任何人在平台中建立和使用通过区块链技术运行的去中心化应用。</p>
<p>在没有以太坊之前，写区块链应用是这样的：拷贝一份比特币代码，然后去改底层代码如加密算法，共识机制，网络协议等等（很多山寨币就是这样，改改就出来一个新币）。</p>
<p>以太坊平台对底层区块链技术进行了封装，让区块链应用开发者可以直接基于以太坊平台进行开发，开发者只要专注于应用本身的开发，从而大大降低了难度。</p>
<h2 id="账户"><a href="#账户" class="headerlink" title="账户"></a>账户</h2><p>为防止replay attack，转账的时候转账人会携带一个nonce值来标识当前他已进行交易的总数，然后对这些信息进行签名。</p>
<p>账户分类：</p>
<ul>
<li>外部账户(externally owned account)：人操作的账户。公私钥对，balance和nonce</li>
<li>合约账户(smart contract account)：智能合约的载体。balance，nonce，code(代码)，storage()；不能自己发起交易；</li>
</ul>
<h2 id="状态树"><a href="#状态树" class="headerlink" title="状态树"></a>状态树</h2><p>账户：account addr(160bits)-&gt;account state(40个16bits)</p>
<p>每次有账户记录更改都是新建新的MPT，只不过大部分节点是复用的(不直接在原MPT上修改是为了防止分叉出现时便于回滚)。</p>
<img src="MPT.png"/>

<img src="MPT1.png"/>

<img src="以太坊BlockHeader.png"/>

<table>
<thead>
<tr>
<th align="center">名称</th>
<th align="center">类型</th>
<th align="center">意义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">parentHash</td>
<td align="center">common.Hash</td>
<td align="center">父区块的哈希值</td>
</tr>
<tr>
<td align="center">UncleHash</td>
<td align="center">common.Hash</td>
<td align="center">叔父区块列表的哈希值</td>
</tr>
<tr>
<td align="center">Coinbase</td>
<td align="center">common.Address</td>
<td align="center">打包该区块的矿工的地址，用于接收矿工费</td>
</tr>
<tr>
<td align="center">Root</td>
<td align="center">common.Hash</td>
<td align="center">状态树的根哈希值</td>
</tr>
<tr>
<td align="center">TxHash</td>
<td align="center">common.Hash</td>
<td align="center">交易树的根哈希值</td>
</tr>
<tr>
<td align="center">ReceiptHash</td>
<td align="center">common.Hash</td>
<td align="center">收据树的根哈希值</td>
</tr>
<tr>
<td align="center">Bloom</td>
<td align="center">Bloom</td>
<td align="center">交易收据日志组成的Bloom过滤器</td>
</tr>
<tr>
<td align="center">Difficulty</td>
<td align="center">*Big.Int</td>
<td align="center">本区块的难度</td>
</tr>
<tr>
<td align="center">Number</td>
<td align="center">*Big.Int</td>
<td align="center">本区块块号，区块号从0号开始算起</td>
</tr>
<tr>
<td align="center">GasLimit</td>
<td align="center">uint64</td>
<td align="center">本区块中所有交易消耗的Gas上限，这个数值不等于所有交易的中Gas limit字段的和</td>
</tr>
<tr>
<td align="center">GasUsed</td>
<td align="center">uint64</td>
<td align="center">本区块中所有交易使用的Gas之和</td>
</tr>
<tr>
<td align="center">Time</td>
<td align="center">*big.Int</td>
<td align="center">区块产生的unix时间戳，一般是打包区块的时间，这个字段不是出块的时间戳</td>
</tr>
<tr>
<td align="center">Extra</td>
<td align="center">[]byte</td>
<td align="center">区块的附加数据</td>
</tr>
<tr>
<td align="center">MixDigest</td>
<td align="center">common.Hash</td>
<td align="center">哈希值，与Nonce的组合用于工作量计算</td>
</tr>
<tr>
<td align="center">Nonce</td>
<td align="center">BlockNonce</td>
<td align="center">区块产生时的随机值</td>
</tr>
</tbody></table>
<img src="以太坊Block.png"/>

<h2 id="交易树和收据树"><a href="#交易树和收据树" class="headerlink" title="交易树和收据树"></a>交易树和收据树</h2><p>交易树和收据树都属于MPT，只把当前区块包含的交易组织起来，而状态树包含了所有的账户信息，块头包含这三棵树的根hash值。</p>
<p>bloom filter：支持查找某个元素是否包含在某个大的集合里(哈希映射)(一般来说不支持删除元素操作，因为考虑到哈希碰撞)。</p>
<p>Merkle Proof：每个交易完成后会生成一个收据，里面包含一个bloom filter记录交易的类型，地址等。发布的区块在它的块头里也有一个总的bloom filter，是这个区块里所有的bloom filter的并集。</p>
<img src="Receipt数据结构.png"/>

<h2 id="GHOST协议"><a href="#GHOST协议" class="headerlink" title="GHOST协议"></a>GHOST协议</h2><ul>
<li>一个区块可以包括两个uncle block(7代之内有共同的祖先，随着代数增加，奖励越来越少)。</li>
<li>一个分叉的非主分支的区块，最多是接下来6个区块的uncle，是当前主分支区块的兄弟区块。</li>
<li>只会接收当前分叉的第一个区块作为uncle block。</li>
<li>主分支的区块招安两个uncle block都由多到少有一定的奖励。</li>
<li>以太坊区块链中7代及其以内的叔父区块都能得到奖励，超过7代的叔父区块将不会得到奖励，这样是为了避免有些矿工专门在之前的链上制造分叉后坐等被后面的节点招安情况。</li>
<li>以太坊中的出块奖励不会随着区块数量的增多而减少，以太坊中无论何时出块都会获得出块奖励，而比特币中区块的树目超过两千一百万以后就没有出块奖励，此后矿工挖矿的动力来自于交易费了。</li>
</ul>
<h2 id="挖矿算法"><a href="#挖矿算法" class="headerlink" title="挖矿算法"></a>挖矿算法</h2><ul>
<li>difficult to solve but easy to verify.</li>
<li>以太坊使用GPU挖矿(原则上的设计应该是可以让旷工使用普通电脑的CPU挖矿)</li>
</ul>
<p>挖矿过程(ethash算法)：</p>
<ol>
<li>对于每一个块，首先计算一个种子(seed)，该种子只和当前块的信息有关;然后根据种子生成一个32M的随机数据集（cache），每隔30000个块会重新生成seed(对原来的seed求hash)，并根据新的seed计算新的cache。cache的初始大小为16M，每隔30000个块大小增大。</li>
<li>根据Cache生成一个1GB大小的数据集合DAG(有向非循环图)，它是一个完整的搜索空间，挖矿的过程就是从DAG中随机选择元素(类似于比特币挖矿中查找合适Nonce)再进行哈希运算，可以从Cache快速计算DAG指定位置的元素，进而哈希验证。每隔30000个块会重新更新，并增大容量。</li>
</ol>
<p>轻节点可以只保存cache，而旷工要保存整个DAG。</p>
<h2 id="难度调整算法"><a href="#难度调整算法" class="headerlink" title="难度调整算法"></a>难度调整算法</h2><p>出块时间：15s</p>
<h2 id="智能合约"><a href="#智能合约" class="headerlink" title="智能合约"></a>智能合约</h2><h3 id="概述-2"><a href="#概述-2" class="headerlink" title="概述"></a>概述</h3><p>智能合约是运行在区块链上的一段代码，代码的逻辑定义了合约的内容，智能合约可以理解为在区块链上可以自动执行的（由消息驱动的）、以代码形式编写的合同（特殊的交易）。Solidity是智能合约最常用的语言。智能合约的账户保存了合约当前的运行状态：</p>
<ul>
<li>balance：余额</li>
<li>nonce：交易次数</li>
<li>code：合约代码</li>
<li>storage：存储，数据结构是一颗MPT</li>
</ul>
<p>EVM（Ethereum Virtual Machine）以太坊虚拟机是以太坊中智能合约的运行环境。它运行在以太坊节点上，当我们把合约部署到以太坊网络上之后，合约就可以在以太坊网络中运行了。</p>
<p>外部账户调用智能合约：创建一个交易，接收地址为要调用的智能合约的地址，data域填写要调用的函数和参数的编码值。</p>
<p>一个合约调用另一个合约中的函数：</p>
<ul>
<li>直接调用(代码中)</li>
<li>使用address类型的call函数</li>
<li>代理调用delegatecall()</li>
</ul>
<p>智能合约的创建和运行：</p>
<ul>
<li>以太坊虚拟机上运行的是合约的字节码形式，需要我们在部署之前先对合约进行编译，代码编写完成后，编译成bytecode</li>
<li>创建合约：外部账户发起一个转账交易到0x0的地址<ul>
<li>转账金额为0，但是要支付汽油费</li>
<li>合约的代码放在data域</li>
</ul>
</li>
<li>智能合约运行在EVM(Ethereum Virtual Machine)上</li>
<li>以太坊是交易驱动的状态机<ul>
<li>调用智能合约的交易发布到区块链上后，每个旷工都会执行这个交易，从当前状态确定性地转移到下一个状态</li>
</ul>
</li>
</ul>
<h3 id="合约部署"><a href="#合约部署" class="headerlink" title="合约部署"></a>合约部署</h3><ul>
<li>以太坊客户端，可以理解为一个开发者工具，它提供账户管理、挖矿、转账、智能合约的部署和执行等等功能</li>
<li>EVM是由以太坊客户端提供的</li>
</ul>
<p>Geth是典型的开发以太坊时使用的客户端，基于Go语言开发。 Geth提供了一个交互式命令控制台，通过命令控制台中包含了以太坊的各种功能（API）。Geth控制台和Chrome浏览器开发者工具里的面的控制台是类似的，不过Geth控制台是跑在终端里。相对于Geth，Mist则是图形化操作界面的以太坊客户端。</p>
<p>智能合约的部署是指把合约字节码发布到区块链上，并使用一个特定的地址来标示这个合约，这个地址称为合约账户。</p>
<p>外部账户与合约账户的区别和关系是这样的：一个外部账户可以通过创建和用自己的私钥来对交易进行签名，来发送消息给另一个外部账户或合约账户。</p>
<p>在两个外部账户之间传送消息是价值转移的过程。但从外部账户到合约账户的消息会激活合约账户的代码，允许它执行各种动作（比如转移代币，写入内部存储，挖出一个新代币，执行一些运算，创建一个新的合约等等）。</p>
<p>只有当外部账户发出指令时，合同账户才会执行相应的操作。</p>
<p>合约部署就是将编译好的合约字节码通过外部账号发送交易的形式部署到以太坊区块链上（由实际矿工出块之后，才真正部署成功）。</p>
<h3 id="合约运行"><a href="#合约运行" class="headerlink" title="合约运行"></a>合约运行</h3><p>合约部署之后，当需要调用这个智能合约的方法时只需要向这个合约账户发送消息（交易）即可，通过消息触发后智能合约的代码就会在EVM中执行了。</p>
<h3 id="Gas"><a href="#Gas" class="headerlink" title="Gas"></a>Gas</h3><ul>
<li>以太坊上用Gas机制来计费，Gas也可以认为是一个工作量单位，智能合约越复杂（计算步骤的数量和类型，占用的内存等），用来完成运行就需要越多Gas。</li>
<li>任何特定的合约所需的运行合约的Gas数量是固定的，由合约的复杂度决定。</li>
<li>而Gas价格由运行合约的人在提交运行合约请求的时候规定，以确定他愿意为这次交易愿意付出的费用：Gas价格（用以太币计价） * Gas数量。</li>
</ul>
<p>Gas的目的是限制执行交易所需的工作量，同时为执行支付费用。当EVM执行交易时，Gas将按照特定规则被逐渐消耗，无论执行到什么位置，一旦Gas被耗尽，将会触发异常。当前调用帧所做的所有状态修改都将被回滚， 如果执行结束还有Gas剩余，这些Gas将被返还给发送账户。如果没有这个限制，就会有人写出无法停止（如：死循环）的合约来阻塞网络。</p>
<p>因此实际上（把前面的内容串起来），我们需要一个有以太币余额的外部账户，来发起一个交易（普通交易或部署、运行一个合约），运行时，矿工收取相应的工作量费用。</p>
<p>汽油费(gas fee)：只有挖矿成功的那个人可以得到</p>
<ul>
<li>智能合约是一个Turing-complete Programming Model</li>
<li>智能合约中的指定要收取汽油费，由交易的人来支付</li>
<li>EVM中不同的指令消耗的汽油费不一样</li>
</ul>
<img src="智能合约可以获取的区块信息.png"/>

<center>智能合约可以获取的区块信息</center>

<p>注意：</p>
<ul>
<li>旷工先执行智能合约，再进行挖矿</li>
<li>旷工要验证刚发布的区块(无偿)，才能更新状态，不然无法进行接下来的挖矿，因为发布的区块里没有三棵树的内容，只是块头里有根hash值。</li>
<li>发布到区块链上的交易不一定是成功执行的，因为要发布后旷工才能拿到汽油费(即使是执行失败的交易也要支付汽油费)。</li>
<li>不支持多线程，无法产生真正意义的随机数(智能合约必须有确定性)。</li>
</ul>
<h2 id="以太坊网络"><a href="#以太坊网络" class="headerlink" title="以太坊网络"></a>以太坊网络</h2><h3 id="以太坊官网测试网络Testnet"><a href="#以太坊官网测试网络Testnet" class="headerlink" title="以太坊官网测试网络Testnet"></a>以太坊官网测试网络Testnet</h3><p>测试网络中，我们可以很容易获得免费的以太币，缺点是需要发很长时间初始化节点。</p>
<h3 id="私有链"><a href="#私有链" class="headerlink" title="私有链"></a>私有链</h3><p>创建自己的以太币私有测试网络，通常也称为私有链，我们可以用它来作为一个测试环境来开发、调试和测试智能合约。通过Geth很容易就可以创建一个属于自己的测试网络，以太币想挖多少挖多少，也免去了同步正式网络的整个区块链数据。</p>
<h3 id="开发者网络-模式"><a href="#开发者网络-模式" class="headerlink" title="开发者网络(模式)"></a>开发者网络(模式)</h3><p>相比私有链，开发者网络(模式)下，会自动分配一个有大量余额的开发者账户给我们使用。</p>
<h3 id="模拟环境"><a href="#模拟环境" class="headerlink" title="模拟环境"></a>模拟环境</h3><p>另一个创建测试网络的方法是使用testrpc，testrpc是在本地使用内存模拟的一个以太坊环境，对于开发调试来说，更方便快捷。而且testrpc可以在启动时帮我们创建10个存有资金的测试账户。进行合约开发时，可以在testrpc中测试通过后，再部署到Geth节点中去。</p>
<p>testrpc 现在已经并入到Truffle 开发框架中，现在名字是Ganache CLI。</p>
<h2 id="DAO"><a href="#DAO" class="headerlink" title="DAO"></a>DAO</h2><ul>
<li>Decentralized Autonomous Organization(去中心化的自治组织)：建立在代码之上，基于共识协议来维护组织制度。</li>
<li>The DAO：一个DAO组织</li>
</ul>
<h2 id="美链"><a href="#美链" class="headerlink" title="美链"></a>美链</h2><p>美链是一个部署在以太坊上的智能合约，有自己的代币BEC。</p>
<h2 id="ABI"><a href="#ABI" class="headerlink" title="ABI"></a>ABI</h2><p>ABI 全称是 Application Binary Interface，应用程序二进制接口，简单来说就是以太坊的合约调用时的接口说明。</p>
<p>从外部施加给以太坊的行为都称之为向以太坊网络提交了一个交易，调用合约函数其实是向合约地址（账户）提交了一个交易，这个交易有一个附加数据，这个附加的数据就是ABI的编码数据。因此要想和合约交互，就离不开ABI数据。</p>
<p>演示调用set(1)时，这个交易附带的数据：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.0</span>;</span><br><span class="line"></span><br><span class="line">contract SimpleStorage &#123;</span><br><span class="line">    </span><br><span class="line">    uint storedData;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">set</span>(<span class="params">uint x</span>) <span class="title">public</span> </span>&#123;</span><br><span class="line">        storedData = x;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"></span>) <span class="title">public</span> <span class="title">constant</span> <span class="title">returns</span> (<span class="params">uint</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> storedData;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>部署到以太坊网络上后，通过参数1调用set函数，打开etherscan查看实时交易数据：</p>
<img src="abi.jpg"/>

<p>这个数据就是ABI的编码数据：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x60fe47b10000000000000000000000000000000000000000000000000000000000000001</span></span><br></pre></td></tr></table></figure>

<p>这个数据可以分成两个子部分：</p>
<ol>
<li>函数选择器(4字节):0x60fe47b1</li>
<li>第一个参数(32字节):00000000000000000000000000000000000000000000000000000000000000001</li>
</ol>
<p>函数选择器值实际是对函数签名字符串进行sha3（keccak256）哈希运算之后，取前4个字节，用代码表示就是(参数部分则是使用对应的16进制数)：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bytes4(sha3(“set(uint256)”)) == <span class="number">0x60fe47b1</span></span><br></pre></td></tr></table></figure>

<p>获得函数对应的ABI有两种方法：</p>
<p>一个是 solidity 提供了ABI的相关API，用来直接得到ABI编码信息，这些函数有：</p>
<ul>
<li>abi.encode(…) returns (bytes)：计算参数的ABI编码。</li>
<li>abi.encodePacked(…) returns (bytes)：计算参数的紧密打包编码</li>
<li>abi. encodeWithSelector(bytes4 selector, …) returns (bytes)： 计算函数选择器和参数的ABI编码</li>
<li>abi.encodeWithSignature(string signature, …) returns (bytes): 等价于* abi.encodeWithSelector(bytes4(keccak256(signature), …)</li>
</ul>
<p>通过ABI编码函数可以在不用调用函数的情况下，获得ABI编码值，下面通过一段代码来看看这些方法的使用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.24</span>;</span><br><span class="line"></span><br><span class="line">contract testABI &#123;</span><br><span class="line">    uint storedData;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">set</span>(<span class="params">uint x</span>) <span class="title">public</span> </span>&#123;</span><br><span class="line">        storedData = x;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">abiEncode</span>(<span class="params"></span>) <span class="title">public</span> <span class="title">constant</span> <span class="title">returns</span> (<span class="params">bytes</span>) </span>&#123;</span><br><span class="line">        abi.encode(<span class="number">1</span>);  <span class="comment">// 计算1的ABI编码</span></span><br><span class="line">        <span class="keyword">return</span> abi.encodeWithSignature(<span class="string">&quot;set(uint256)&quot;</span>, <span class="number">1</span>); <span class="comment">//计算函数set(uint256) 及参数1 的ABI 编码</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>另一个web3提供相应的API，例如使用web3计算函数选择器的方式如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">web3.eth.abi.encodeFunctionSignature(<span class="string">&#x27;myMethod(uint256,string)&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="Dapp"><a href="#Dapp" class="headerlink" title="Dapp"></a>Dapp</h2><p>以太坊社区把基于智能合约的应用称为去中心化的应用程序(Decentralized App)。如果我们把区块链理解为一个不可篡改的数据库，智能合约理解为和数据库打交道的程序，那就很容易理解Dapp了，一个Dapp不单单有智能合约，比如还需要有一个友好的用户界面和其他的东西。</p>
<p>Truffle是Dapp开发框架，他可以帮我们处理掉大量无关紧要的小事情，让我们可以迅速开始写代码-编译-部署-测试-打包DApp这个流程。</p>
<img src="dapp.jpg"/>

<p>DAPP和传统App关键是后端部分不同，后端不再是一个中心化的服务器，而是分布式网络上任意节点，注意可以是任意一个节点，在应用中给节点发送的请求通常称为交易，交易和中心化下的请求有几个很大的不同是：交易的数据经过用户个人签名之后发送到节点，节点收到交易请求之后，会把请求广播到整个网络，交易在网络达成共识之后，才算是真正的执行。中心化下的请求大多数都是同步的（及时拿到结果），而交易大多数是异步的，这也是在开发去中心应用时需要注意的地方，从节点上获得数据状态（比如交易的结果），一般是通过事件回调来获得。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>以太坊是平台，它让我们方便的使用区块链技术开发去中心化的应用，在这个应用中，使用Solidity来编写和区块链交互的智能合约，合约编写好后之后，我们需要用以太坊客户端用一个有余额的账户去部署及运行合约（使用Truffle框架可以更好的帮助我们做这些事情了）。为了开发方便，我们可以用Geth或testrpc来搭建一个测试网络。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://ljd1996.github.io/2018/11/22/%E5%B7%A5%E5%85%B7%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="苍耳叔叔">
      <meta itemprop="description" content="梦里寻她千百度，蓦然回首，那人却在，灯火阑珊处。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="苍耳的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/11/22/%E5%B7%A5%E5%85%B7%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">工具笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-11-22 13:49:44" itemprop="dateCreated datePublished" datetime="2018-11-22T13:49:44+08:00">2018-11-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-14 14:14:57" itemprop="dateModified" datetime="2021-05-14T14:14:57+08:00">2021-05-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">工具</span></a>
                </span>
            </span>

          
            <span id="/2018/11/22/%E5%B7%A5%E5%85%B7%E7%AC%94%E8%AE%B0/" class="post-meta-item leancloud_visitors" data-flag-title="工具笔记" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2018/11/22/%E5%B7%A5%E5%85%B7%E7%AC%94%E8%AE%B0/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2018/11/22/%E5%B7%A5%E5%85%B7%E7%AC%94%E8%AE%B0/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="爬百度图片"><a href="#爬百度图片" class="headerlink" title="爬百度图片"></a>爬百度图片</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_page_url</span>(<span class="params">url, param</span>):</span></span><br><span class="line">    response = requests.get(url, params=param)</span><br><span class="line">    response.encoding = <span class="string">&#x27;utf-8&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> response.text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_page</span>(<span class="params">str</span>):</span></span><br><span class="line">    pattern = re.compile(<span class="string">&#x27;&quot;middleURL&quot;:&quot;(.*?)&quot;,&#x27;</span>)  <span class="comment">#利用正则匹配图片url</span></span><br><span class="line">    url_list = re.findall(pattern, str)</span><br><span class="line">    <span class="keyword">return</span> url_list</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">keyword, path, num</span>):</span></span><br><span class="line">    url = <span class="string">&quot;https://image.baidu.com/search/acjson&quot;</span></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line"><span class="comment">#    size = 0</span></span><br><span class="line"><span class="comment">#    if int(num) &lt; 30:</span></span><br><span class="line"><span class="comment">#        size = int(num)</span></span><br><span class="line"><span class="comment">#    else:</span></span><br><span class="line"><span class="comment">#        size = 30</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0</span>, int(num), <span class="number">30</span>):</span><br><span class="line">        params = &#123;<span class="string">&quot;ipn&quot;</span>: <span class="string">&quot;rj&quot;</span>, <span class="string">&quot;tn&quot;</span>: <span class="string">&quot;resultjson_com&quot;</span>, <span class="string">&quot;word&quot;</span>: keyword, <span class="string">&quot;pn&quot;</span>: str(j)&#125;</span><br><span class="line">        html = get_page_url(url, params)</span><br><span class="line">        lists = parse_page(html)</span><br><span class="line">        print(lists)</span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> lists:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                img_data = requests.get(item, timeout=<span class="number">10</span>).content</span><br><span class="line">                <span class="keyword">with</span> open(path + <span class="string">&quot;/&quot;</span> + str(i) + <span class="string">&quot;.jpg&quot;</span>, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                    f.write(img_data)</span><br><span class="line">                    f.close()</span><br><span class="line">                i = i+<span class="number">1</span></span><br><span class="line">            <span class="keyword">except</span> requests.exceptions.ConnectionError:</span><br><span class="line">                print(<span class="string">&#x27;can not download&#x27;</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_dir</span>(<span class="params">keyword</span>):</span></span><br><span class="line">    path = <span class="string">&#x27;百度图片/&#x27;</span></span><br><span class="line">    path = path+keyword</span><br><span class="line">    is_exists = os.path.exists(path)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> is_exists:</span><br><span class="line">        os.makedirs(path)</span><br><span class="line">        <span class="keyword">return</span> path</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(path + <span class="string">&#x27;目录已存在&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> path</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    keyword = input(<span class="string">&quot;input keyword about images you want to download: &quot;</span>)</span><br><span class="line">    num = input(<span class="string">&quot;input the number that you want: &quot;</span>)</span><br><span class="line">    path = make_dir(keyword)</span><br><span class="line">    run(keyword, path, num)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<h1 id="爬百度资讯文章"><a href="#爬百度资讯文章" class="headerlink" title="爬百度资讯文章"></a>爬百度资讯文章</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> pyquery <span class="keyword">import</span> PyQuery <span class="keyword">as</span> pq</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_page</span>(<span class="params">url</span>):</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;user-agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.77 Safari/537.36&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;accept-language&#x27;</span>: <span class="string">&#x27;zh-CN,zh;q=0.9&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;cache-control&#x27;</span>: <span class="string">&#x27;max-age=0&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;accept&#x27;</span>: <span class="string">&#x27;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    response = requests.get(url=url,headers=headers)</span><br><span class="line">    response.encoding = <span class="string">&quot;utf-8&quot;</span></span><br><span class="line">    <span class="comment"># print(response.status_code)</span></span><br><span class="line">    <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">        <span class="keyword">return</span> response.text</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    keyword = input(<span class="string">&quot;input keyword about news that you want to download: &quot;</span>)</span><br><span class="line">    numStart = input(<span class="string">&quot;input the start number that you want: &quot;</span>)</span><br><span class="line">    numEnd = input(<span class="string">&quot;input the end number that you want: &quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> page <span class="keyword">in</span> range(int(numStart), int(numEnd)):</span><br><span class="line">        url = <span class="string">&#x27;https://www.baidu.com/s?rtt=1&amp;bsst=1&amp;cl=2&amp;tn=news&amp;medium=2&amp;word=&#x27;</span> + keyword + <span class="string">&#x27;&amp;pn=&#x27;</span> + str(page*<span class="number">10</span>)</span><br><span class="line">        result = pq(get_page(url))</span><br><span class="line">        print(<span class="string">&#x27;\nnow the page is &#x27;</span>+str(page) + <span class="string">&#x27; and the url is &#x27;</span> + url)</span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> range(result(<span class="string">&#x27;.result&#x27;</span>).size()):</span><br><span class="line">            url = pq(result(<span class="string">&#x27;.result&#x27;</span>).eq(item).html())(<span class="string">&#x27;a&#x27;</span>).attr(<span class="string">&#x27;href&#x27;</span>)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="comment"># 下载文章</span></span><br><span class="line">                d = pq(url=url)</span><br><span class="line">                title = d(<span class="string">&#x27;.article-title&#x27;</span>).text()</span><br><span class="line">                print(<span class="string">&#x27;now the article is &#x27;</span> + title)</span><br><span class="line">                print(<span class="string">&#x27;now the url is &#x27;</span> + url + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(title):</span><br><span class="line">                    os.mkdir(title)</span><br><span class="line">                fobj = open(title + <span class="string">&#x27;/&#x27;</span> + title + <span class="string">&#x27;.txt&#x27;</span>, <span class="string">&#x27;w+&#x27;</span>)</span><br><span class="line">                fobj.write(d(<span class="string">&#x27;.article-title&#x27;</span>).text())</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> range(d(<span class="string">&#x27;.bjh-p&#x27;</span>).size()):</span><br><span class="line">                    fobj.write(<span class="string">&#x27;\n&#x27;</span> + d(<span class="string">&#x27;.bjh-p&#x27;</span>).eq(i).text())</span><br><span class="line">                fobj.close()</span><br><span class="line">                <span class="comment"># 下载图片</span></span><br><span class="line">                <span class="keyword">for</span> imgIndex <span class="keyword">in</span> range(d(<span class="string">&#x27;.img-container&#x27;</span>).size()):</span><br><span class="line">                    img_data = requests.get(pq(d(<span class="string">&#x27;.img-container&#x27;</span>).eq(imgIndex).html())(<span class="string">&#x27;img&#x27;</span>).attr(<span class="string">&#x27;src&#x27;</span>), timeout=<span class="number">10</span>).content</span><br><span class="line">                    <span class="keyword">with</span> open(title + <span class="string">&quot;/&quot;</span> + str(imgIndex) + <span class="string">&quot;.jpg&quot;</span>, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                        f.write(img_data)</span><br><span class="line">                        f.close()</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                print(<span class="string">&#x27;there is a error when parsing this article, maybe it is not exist.&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h1 id="比较目录差异"><a href="#比较目录差异" class="headerlink" title="比较目录差异"></a>比较目录差异</h1><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.security.MessageDigest</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SimilarCalculate</span> &#123;</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> main(String[] args) &#123;</span><br><span class="line">        <span class="keyword">if</span> (args == <span class="literal">null</span> || args.length &lt; <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        String path1 = args[<span class="number">0</span>]</span><br><span class="line">        String path2 = args[<span class="number">1</span>]</span><br><span class="line">        compareByCode(path1, path2)</span><br><span class="line">        println(<span class="string">&quot;--------------------------------------&quot;</span>)</span><br><span class="line">        compareByShell(path1, path2)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> compareByCode(String path1, String path2) &#123;</span><br><span class="line">        <span class="keyword">def</span> f1 = <span class="keyword">new</span> File(path1)</span><br><span class="line">        <span class="keyword">def</span> f2 = <span class="keyword">new</span> File(path2)</span><br><span class="line">        <span class="keyword">int</span> diffCount1, nonCount1, diffCount2, nonCount2</span><br><span class="line">        (diffCount1, nonCount1) = compareDir(f1, f2)</span><br><span class="line">        (diffCount2, nonCount2) = compareDir(f2, f1)</span><br><span class="line">        println(<span class="string">&quot;Value: $diffCount1, $nonCount1, $diffCount2, $nonCount2&quot;</span>)</span><br><span class="line">        printResult(f1, diffCount1 + nonCount1 + nonCount2)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> List&lt;Integer&gt; compareDir(File src, File des) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!src.isDirectory() || !des.isDirectory()) &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> diffCount = <span class="number">0</span></span><br><span class="line">        <span class="keyword">int</span> nonCount = <span class="number">0</span></span><br><span class="line">        src.eachFileRecurse &#123;</span><br><span class="line">            <span class="keyword">if</span> (it.isFile()) &#123;</span><br><span class="line">                String subPath = src.relativePath(it)</span><br><span class="line">                File desFile = <span class="keyword">new</span> File(des, subPath)</span><br><span class="line">                <span class="keyword">if</span> (desFile.exists()) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (!fileSame(it, desFile)) &#123;</span><br><span class="line">                        diffCount++</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    nonCount++</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> [diffCount, nonCount]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> printResult(File origin, <span class="keyword">int</span> diff) &#123;</span><br><span class="line">        <span class="keyword">int</span> total = <span class="number">0</span></span><br><span class="line">        origin.eachFileRecurse &#123;</span><br><span class="line">            <span class="keyword">if</span> (it.isFile()) &#123;</span><br><span class="line">                total++</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        println(<span class="string">&quot;Diff: $&#123;diff&#125;, Total: $&#123;total&#125;, Percentage: $&#123;diff * 1f / total&#125;&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> compareByShell(String path1, String path2) &#123;</span><br><span class="line">        <span class="keyword">def</span> f1 = <span class="keyword">new</span> File(path1)</span><br><span class="line">        <span class="keyword">def</span> f2 = <span class="keyword">new</span> File(path2)</span><br><span class="line">        createDir(f1, f2)</span><br><span class="line">        createDir(f2, f1)</span><br><span class="line">        String result = <span class="string">&quot;diff -rq $path1 $path2&quot;</span>.execute().text.trim()</span><br><span class="line">        printResult(f1, getLineNumberByIo(result))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> getLineNumberByIo(String target) &#123;</span><br><span class="line">        LineNumberReader lnr = <span class="keyword">new</span> LineNumberReader(<span class="keyword">new</span> CharArrayReader(target.toCharArray()))</span><br><span class="line">        lnr.skip(Long.MAX_VALUE)</span><br><span class="line">        lnr.close()</span><br><span class="line">        <span class="keyword">return</span> lnr.getLineNumber() + <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> createDir(File src, File des) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!src.isDirectory() || !des.isDirectory()) &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        src.eachFileRecurse &#123;</span><br><span class="line">            <span class="keyword">if</span> (it.isDirectory()) &#123;</span><br><span class="line">                String subPath = src.relativePath(it)</span><br><span class="line">                File newFile = <span class="keyword">new</span> File(des, subPath)</span><br><span class="line">                <span class="keyword">if</span> (!newFile.exists()) &#123;</span><br><span class="line"><span class="comment">//                    println(&quot;Create path in $&#123;des.absolutePath&#125;: $subPath&quot;)</span></span><br><span class="line">                    newFile.mkdirs()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// --------------------------------------------------------------------------------------------------------- //</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> fileSame(File f1, File f2) &#123;</span><br><span class="line">        <span class="keyword">return</span> getMD5(f1) == getMD5(f2)</span><br><span class="line"><span class="comment">//        String s1 = is2String(new FileInputStream(f1))</span></span><br><span class="line"><span class="comment">//        String s2 = is2String(new FileInputStream(f2))</span></span><br><span class="line"><span class="comment">//        return s1 == s2</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String is2String(InputStream is) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(is)).lines().parallel().collect(Collectors.joining(<span class="string">&quot;\n&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String getMD5(File file) &#123;</span><br><span class="line">        FileInputStream fileInputStream = <span class="literal">null</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            MessageDigest MD5 = MessageDigest.getInstance(<span class="string">&quot;MD5&quot;</span>)</span><br><span class="line">            fileInputStream = <span class="keyword">new</span> FileInputStream(file)</span><br><span class="line">            <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">8192</span>]</span><br><span class="line">            <span class="keyword">int</span> length</span><br><span class="line">            <span class="keyword">while</span> ((length = fileInputStream.read(buffer)) != <span class="number">-1</span>) &#123;</span><br><span class="line">                MD5.update(buffer, <span class="number">0</span>, length)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> String(encodeHex(MD5.digest()))</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace()</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (fileInputStream != <span class="literal">null</span>) &#123;</span><br><span class="line">                    fileInputStream.close()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Used to build output as Hex</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">char</span>[] DIGITS_LOWER =</span><br><span class="line">            [<span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;f&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Used to build output as Hex</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">char</span>[] DIGITS_UPPER =</span><br><span class="line">            [<span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;F&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">char</span>[] encodeHex(<span class="keyword">final</span> <span class="keyword">byte</span>[] data) &#123;</span><br><span class="line">        <span class="keyword">return</span> encodeHex(data, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">char</span>[] encodeHex(<span class="keyword">final</span> <span class="keyword">byte</span>[] data, <span class="keyword">final</span> <span class="keyword">boolean</span> toLowerCase) &#123;</span><br><span class="line">        <span class="keyword">return</span> encodeHex(data, toLowerCase ? DIGITS_LOWER : DIGITS_UPPER);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">char</span>[] encodeHex(<span class="keyword">final</span> <span class="keyword">byte</span>[] data, <span class="keyword">final</span> <span class="keyword">char</span>[] toDigits) &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> l = data.length;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">char</span>[] out = <span class="keyword">new</span> <span class="keyword">char</span>[l &lt;&lt; <span class="number">1</span>];</span><br><span class="line">        <span class="comment">// two characters form the hex value.</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>; i &lt; l; i++) &#123;</span><br><span class="line">            out[j++] = toDigits[(<span class="number">0xF0</span> &amp; data[i]) &gt;&gt;&gt; <span class="number">4</span>];</span><br><span class="line">            out[j++] = toDigits[<span class="number">0x0F</span> &amp; data[i]];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> out;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://ljd1996.github.io/2018/11/20/Go%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="苍耳叔叔">
      <meta itemprop="description" content="梦里寻她千百度，蓦然回首，那人却在，灯火阑珊处。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="苍耳的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/11/20/Go%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">Go学习笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-11-20 22:01:29" itemprop="dateCreated datePublished" datetime="2018-11-20T22:01:29+08:00">2018-11-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-14 14:14:57" itemprop="dateModified" datetime="2021-05-14T14:14:57+08:00">2021-05-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index"><span itemprop="name">语言</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AF%AD%E8%A8%80/Go/" itemprop="url" rel="index"><span itemprop="name">Go</span></a>
                </span>
            </span>

          
            <span id="/2018/11/20/Go%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="post-meta-item leancloud_visitors" data-flag-title="Go学习笔记" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2018/11/20/Go%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2018/11/20/Go%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="安装与配置"><a href="#安装与配置" class="headerlink" title="安装与配置"></a>安装与配置</h1><p>环境变量：</p>
<ul>
<li>GOROOT：Go的安装目录</li>
<li>GOPATH：Go的工作区的集合，通过go get下载的扩展包会放在其中</li>
<li>GOBIN：存放Go程序的可执行文件</li>
<li>PATH：<code>export PATH=$PATH:$GOROOT:/bin:$GOBIN</code></li>
</ul>
<h1 id="基本规则"><a href="#基本规则" class="headerlink" title="基本规则"></a>基本规则</h1><h2 id="工作区"><a href="#工作区" class="headerlink" title="工作区"></a>工作区</h2><p>工作区是放置Go源码文件的目录。一般情况下，Go源码文件都需要存放到工作区中。但是对于命令源码文件来说，这不是必须的。</p>
<p>每一个工作区的结构都类似包含：golib/,src/,pkg/,bin/</p>
<ul>
<li>src目录用于存放源码文件;以代码包为组织形式</li>
<li>pkg目录用于存放归档文件(名称以.a为后缀的文件) 所有归档文件都会被存放到该目录下的平台相关目录中，用样以代码包为组织形式</li>
<li>平台相关目录:两个隐含的Go语言环境变量:GOOS和GOARCH</li>
</ul>
<h1 id="命令基础"><a href="#命令基础" class="headerlink" title="命令基础"></a>命令基础</h1><ul>
<li>go build 用于编译源码文件、代码包、依赖包</li>
<li>go run  可以编译并运行Go源码文件</li>
<li>go get  主要是用来动态获取远程代码包</li>
</ul>
<h1 id="基础语法"><a href="#基础语法" class="headerlink" title="基础语法"></a>基础语法</h1><h2 id="基本结构"><a href="#基本结构" class="headerlink" title="基本结构"></a>基本结构</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> NAME <span class="keyword">string</span> = <span class="string">&quot;Hello&quot;</span> <span class="comment">//常量</span></span><br><span class="line"><span class="keyword">var</span> a <span class="keyword">string</span> = <span class="string">&quot;aaa&quot;</span>        <span class="comment">//全局变量的声明和赋值</span></span><br><span class="line"><span class="keyword">type</span> b <span class="keyword">int</span>                  <span class="comment">//一般类型的声明</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;                           <span class="comment">//结构体的声明</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> IUser <span class="keyword">interface</span> &#123;</span><br><span class="line">&#125;                           <span class="comment">//接口的声明</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fun</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;                           <span class="comment">//函数声明</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;hello&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="package"><a href="#package" class="headerlink" title="package"></a>package</h2><ul>
<li>package是<strong>最基本得分发单位</strong>和<strong>工程管理中依赖关系的体现</strong></li>
<li>每个Go语言的代码文件<strong>开头</strong>都拥有一个package声明，表示源码文件所属的代码包</li>
<li>要生成GO语言<strong>可执行程序</strong>，必须要有main的package包，且必须在该包下有**main()**函数</li>
<li><strong>同一路径下只能存在一个package</strong>，一个package可以拆分成多个源文件组成</li>
</ul>
<h2 id="import"><a href="#import" class="headerlink" title="import"></a>import</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;pac1&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;pac2&quot;</span></span><br></pre></td></tr></table></figure>

<p>等价于：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;pac1&quot;</span></span><br><span class="line">	<span class="string">&quot;pac2&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ul>
<li>如果一个main导入其他包，包将被顺序导入</li>
<li>如果导入的包中有其他包（包B），会首先导入B包，然后初始化B包中的常量与变量，最后如果B中有init，会自动执行init（）；</li>
<li>所有包导入完成之后才会对main中常量和变量进行初始化，然后执行main中的init函数（如果存在），最后执行main函数；</li>
<li>如果一个包被导入多次，则该包只会被导入一次。</li>
</ul>
<img src="import原理.png"/>

<h1 id="变量和常量"><a href="#变量和常量" class="headerlink" title="变量和常量"></a>变量和常量</h1><h2 id="变量声明"><a href="#变量声明" class="headerlink" title="变量声明"></a>变量声明</h2><p>第一种，指定变量类型，声明后若不赋值，使用默认值。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> v_name v_type</span><br><span class="line">v_name = value</span><br></pre></td></tr></table></figure>

<p>第二种，根据值自行判定变量类型。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> v_name = value</span><br></pre></td></tr></table></figure>

<p>第三种，省略var, <strong><code>:=</code>左侧的变量不应该是已经声明过的，否则会导致编译错误。这是使用变量的首选形式，但是它只能被用在函数体内，而不可以用于全局变量的声明与赋值。使用操作符 := 可以高效地创建一个新的变量，称之为初始化声明。</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v_name := value</span><br></pre></td></tr></table></figure>

<p><strong>如果想要交换两个变量的值，则可以简单地使用 a, b = b, a，两个变量的类型必须是相同。</strong></p>
<h2 id="多变量声明"><a href="#多变量声明" class="headerlink" title="多变量声明"></a>多变量声明</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//类型相同多个变量, 非全局变量</span></span><br><span class="line"><span class="keyword">var</span> vname1, vname2, vname3 <span class="keyword">type</span></span><br><span class="line">vname1, vname2, vname3 = v1, v2, v3</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> vname1, vname2, vname3 = v1, v2, v3 <span class="comment">//和python很像,不需要显示声明类型，自动推断</span></span><br><span class="line"></span><br><span class="line">vname1, vname2, vname3 := v1, v2, v3 <span class="comment">//出现在:=左侧的变量不应该是已经被声明过的，否则会导致编译错误</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 这种因式分解关键字的写法一般用于声明全局变量</span></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">    vname1 v_type1</span><br><span class="line">    vname2 v_type2</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> x, y <span class="keyword">int</span></span><br><span class="line"><span class="keyword">var</span> (  <span class="comment">// 这种因式分解关键字的写法一般用于声明全局变量</span></span><br><span class="line">    a <span class="keyword">int</span></span><br><span class="line">    b <span class="keyword">bool</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> c, d <span class="keyword">int</span> = <span class="number">1</span>, <span class="number">2</span></span><br><span class="line"><span class="keyword">var</span> e, f = <span class="number">123</span>, <span class="string">&quot;hello&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//这种不带声明格式的只能在函数体中出现</span></span><br><span class="line"><span class="comment">//g, h := 123, &quot;hello&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    g, h := <span class="number">123</span>, <span class="string">&quot;hello&quot;</span></span><br><span class="line">    <span class="built_in">println</span>(x, y, a, b, c, d, e, f, g, h)</span><br><span class="line">&#125;</span><br><span class="line">以上实例执行结果为：</span><br><span class="line"></span><br><span class="line"><span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="literal">false</span> <span class="number">1</span> <span class="number">2</span> <span class="number">123</span> hello <span class="number">123</span> hello</span><br></pre></td></tr></table></figure>

<h2 id="值类型和引用类型"><a href="#值类型和引用类型" class="headerlink" title="值类型和引用类型"></a>值类型和引用类型</h2><p>所有像 int、float、bool 和 string 这些基本类型都属于值类型，使用这些类型的变量直接指向存在内存中的值,当使用等号 = 将一个变量的值赋值给另一个变量时，如：j = i，实际上是在内存中将 i 的值进行了拷贝, 值类型的变量的值存储在栈中。</p>
<p>更复杂的数据通常会需要使用多个字，这些数据一般使用引用类型保存。一个引用类型的变量 r1 存储的是 r1 的值所在的内存地址（数字），或内存地址中第一个字所在的位置。这个内存地址为称之为指针，这个指针实际上也被存在另外的某一个字中。同一个引用类型的指针指向的多个字可以是在连续的内存地址中（内存布局是连续的），这也是计算效率最高的一种存储形式；也可以将这些字分散存放在内存中，每个字都指示了下一个字所在的内存地址。</p>
<p>当使用赋值语句 r2 = r1 时，只有引用（地址）被复制,如果 r1 的值被改变了，那么这个值的所有引用都会指向被修改后的内容。</p>
<h2 id="常量"><a href="#常量" class="headerlink" title="常量"></a>常量</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> identifier [<span class="keyword">type</span>] = value</span><br><span class="line"></span><br><span class="line"><span class="comment">// 多个相同类型的声明可以简写为：</span></span><br><span class="line"><span class="keyword">const</span> c_name1, c_name2 = value1, value2</span><br><span class="line"></span><br><span class="line"><span class="comment">// 常量还可以用作枚举：</span></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    Unknown = <span class="number">0</span></span><br><span class="line">    Female = <span class="number">1</span></span><br><span class="line">    Male = <span class="number">2</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>字符串类型在 go 里是个结构, 包含指向底层数组的指针和长度,这两部分每部分都是 8 个字节，所以字符串类型大小为 16 个字节。</p>
<h2 id="iota"><a href="#iota" class="headerlink" title="iota"></a>iota</h2><p>iota，特殊常量，可以认为是一个可以被编译器修改的常量。iota 在 const关键字出现时将被重置为 0(const 内部的第一行之前)，const 中每新增一行常量声明将使 iota 计数一次(iota 可理解为 const 语句块中的行索引)。</p>
<p>iota 可以被用作枚举值：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    a = <span class="literal">iota</span></span><br><span class="line">    b = <span class="literal">iota</span></span><br><span class="line">    c = <span class="literal">iota</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>第一个 iota 等于 0，每当 iota 在新的一行被使用时，它的值都会自动加 1；所以 a=0, b=1, c=2 可以简写为如下形式：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    a = <span class="literal">iota</span></span><br><span class="line">    b</span><br><span class="line">    c</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">const</span> (</span><br><span class="line">            a = <span class="literal">iota</span>   <span class="comment">//0</span></span><br><span class="line">            b          <span class="comment">//1</span></span><br><span class="line">            c          <span class="comment">//2</span></span><br><span class="line">            d = <span class="string">&quot;ha&quot;</span>   <span class="comment">//独立值，iota += 1</span></span><br><span class="line">            e          <span class="comment">//&quot;ha&quot;   iota += 1</span></span><br><span class="line">            f = <span class="number">100</span>    <span class="comment">//iota +=1</span></span><br><span class="line">            g          <span class="comment">//100  iota +=1</span></span><br><span class="line">            h = <span class="literal">iota</span>   <span class="comment">//7,恢复计数</span></span><br><span class="line">            i          <span class="comment">//8</span></span><br><span class="line">    )</span><br><span class="line">    fmt.Println(a,b,c,d,e,f,g,h,i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 以上实例运行结果为：</span></span><br><span class="line"><span class="comment">//0 1 2 ha ha 100 100 7 8</span></span><br></pre></td></tr></table></figure>

<p>再看个有趣的的 iota 实例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    i=<span class="number">1</span>&lt;&lt;<span class="literal">iota</span></span><br><span class="line">    j=<span class="number">3</span>&lt;&lt;<span class="literal">iota</span></span><br><span class="line">    k</span><br><span class="line">    l</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;i=&quot;</span>,i)</span><br><span class="line">    fmt.Println(<span class="string">&quot;j=&quot;</span>,j)</span><br><span class="line">    fmt.Println(<span class="string">&quot;k=&quot;</span>,k)</span><br><span class="line">    fmt.Println(<span class="string">&quot;l=&quot;</span>,l)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//以上实例运行结果为：</span></span><br><span class="line"><span class="comment">//i= 1</span></span><br><span class="line"><span class="comment">//j= 6</span></span><br><span class="line"><span class="comment">//k= 12</span></span><br><span class="line"><span class="comment">//l= 24</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//i=1：左移 0 位,不变仍为 1;</span></span><br><span class="line"><span class="comment">//j=3：左移 1 位,变为二进制 110, 即 6;</span></span><br><span class="line"><span class="comment">//k=3：左移 2 位,变为二进制 1100, 即 12;</span></span><br><span class="line"><span class="comment">//l=3：左移 3 位,变为二进制 11000,即 24。</span></span><br></pre></td></tr></table></figure>

<h2 id="new和make"><a href="#new和make" class="headerlink" title="new和make"></a>new和make</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">make</span><span class="params">(t Type, size ...IntegerType)</span> <span class="title">Type</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">new</span><span class="params">(Type)</span> *<span class="title">Type</span></span></span><br></pre></td></tr></table></figure>

<p>二者都是内存的分配（堆上），但是make只用于slice、map以及channel的初始化（非零值）；而new用于类型的内存分配，并且内存置为零(new不常用)。</p>
<h1 id="流程控制"><a href="#流程控制" class="headerlink" title="流程控制"></a>流程控制</h1><h2 id="条件语句"><a href="#条件语句" class="headerlink" title="条件语句"></a>条件语句</h2><h3 id="if-else-switch"><a href="#if-else-switch" class="headerlink" title="if-else/switch"></a>if-else/switch</h3><table>
<thead>
<tr>
<th align="center">语句</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">if bool {} else {}</td>
<td align="center">判断语句</td>
</tr>
<tr>
<td align="center">switch</td>
<td align="center">switch 语句用于基于不同条件执行不同动作。</td>
</tr>
</tbody></table>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="literal">true</span> &#123;</span><br><span class="line">	</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">switch</span> expr &#123;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="select"><a href="#select" class="headerlink" title="select"></a>select</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ch1 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">1</span>)</span><br><span class="line">ch2 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">1</span>)</span><br><span class="line"><span class="comment">// 省略若干条语句</span></span><br><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line">	<span class="keyword">case</span> e1 := &lt;-ch1:</span><br><span class="line">		fmt.Printf(<span class="string">&quot;1th case is selected. e1=%v.\n&quot;</span>, e1)</span><br><span class="line">	<span class="keyword">case</span> e2 := &lt;-ch2:</span><br><span class="line">		fmt.Printf(<span class="string">&quot;2th case is selected. e2=%v.\n&quot;</span>, e2)</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		fmt.Println(<span class="string">&quot;No data!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果该select语句被执行时通道ch1和ch2中都没有任何数据，那么肯定只有default case会被执行。但是，只要有一个通道在当时有数据就不会轮到default case执行了。显然，对于包含通道接收操作的case来讲，其执行条件就是通道中存在数据（或者说通道未空）。如果在当时有数据的通道多于一个，那么Go语言会通过一种伪随机的算法来决定哪一个case将被执行。</p>
<h3 id="defer"><a href="#defer" class="headerlink" title="defer"></a>defer</h3><p>defer代码块会在函数调用链表中增加一个函数调用。这个函数调用不是普通的函数调用，而是会在函数正常返回，也就是return之后添加一个函数调用。因此，defer通常用来释放函数内部变量。</p>
<ol>
<li>defer执行顺序为先进后出</li>
</ol>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">deferIt</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    	fmt.Print(<span class="number">1</span>)</span><br><span class="line">	&#125;()</span><br><span class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		fmt.Print(<span class="number">2</span>)</span><br><span class="line">	&#125;()</span><br><span class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">   		fmt.Print(<span class="number">3</span>)</span><br><span class="line">	&#125;()</span><br><span class="line">	fmt.Print(<span class="number">4</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// deferIt函数的执行会使标准输出上打印出4321。</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>当defer被声明时，其参数就会被实时解析,函数值和函数参数被求值，但函数不会立即调用</li>
</ol>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">a</span><span class="params">()</span></span> &#123;</span><br><span class="line">	i := <span class="number">0</span></span><br><span class="line">	<span class="keyword">defer</span> fmt.Println(i)</span><br><span class="line">	i++</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;	<span class="comment">// 0</span></span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">deferIt3</span><span class="params">()</span></span> &#123;</span><br><span class="line">    f := <span class="function"><span class="keyword">func</span><span class="params">(i <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">        fmt.Printf(<span class="string">&quot;%d &quot;</span>,i)</span><br><span class="line">        <span class="keyword">return</span> i * <span class="number">10</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt; <span class="number">5</span>; i++ &#123;</span><br><span class="line">        <span class="keyword">defer</span> fmt.Printf(<span class="string">&quot;%d &quot;</span>, f(i))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;	<span class="comment">// 1 2 3 4 40 30 20 10</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>defer可以读取有名返回值</li>
</ol>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">c</span><span class="params">()</span> <span class="params">(i <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; i++ &#125;()</span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">&#125;	<span class="comment">// 1	2</span></span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">deferIt4</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt; <span class="number">5</span>; i++ &#123;</span><br><span class="line">        <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">            fmt.Print(i)</span><br><span class="line">        &#125;()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;	<span class="comment">// 5555</span></span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">deferIt4</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt; <span class="number">5</span>; i++ &#123;</span><br><span class="line">        <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">(n <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">            fmt.Print(n)</span><br><span class="line">        &#125;(i)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;	<span class="comment">// 4321</span></span><br></pre></td></tr></table></figure>

<h2 id="循环语句"><a href="#循环语句" class="headerlink" title="循环语句"></a>循环语句</h2><p>go语言没有while语句，可用for实现。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i := <span class="number">1</span>; i &lt; <span class="number">101</span>; i++ &#123;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h1><p>go中函数可以返回多个值：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">function_name</span><span class="params">([parameter <span class="keyword">type</span>])</span> [<span class="title">return_types</span>...]</span> &#123;</span><br><span class="line">	<span class="comment">// 函数体</span></span><br><span class="line">	[<span class="keyword">return</span> x...]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>函数作为变量：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">   <span class="comment">/* 声明函数变量 */</span></span><br><span class="line">   getSquareRoot := <span class="function"><span class="keyword">func</span><span class="params">(x <span class="keyword">float64</span>)</span> <span class="title">float64</span></span> &#123;</span><br><span class="line">      <span class="keyword">return</span> math.Sqrt(x)</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/* 使用函数 */</span></span><br><span class="line">   fmt.Println(getSquareRoot(<span class="number">9</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Go 语言支持匿名函数，可作为闭包：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getSequence</span><span class="params">()</span> <span class="title">func</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	i:=<span class="number">0</span></span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">		i+=<span class="number">1</span></span><br><span class="line">		<span class="keyword">return</span> i  </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="comment">/* nextNumber 为一个函数，函数 i 为 0 */</span></span><br><span class="line">	nextNumber := getSequence()  </span><br><span class="line"></span><br><span class="line">	<span class="comment">/* 调用 nextNumber 函数，i 变量自增 1 并返回 */</span></span><br><span class="line">	fmt.Println(nextNumber())</span><br><span class="line">	fmt.Println(nextNumber())</span><br><span class="line">	fmt.Println(nextNumber())</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* 创建新的函数 nextNumber1，并查看结果 */</span></span><br><span class="line">	nextNumber1 := getSequence()  </span><br><span class="line">	fmt.Println(nextNumber1())</span><br><span class="line">	fmt.Println(nextNumber1())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>既然可以在代表函数的变量上实施调用表达式，那么在匿名函数上肯定也是可行的。因为它们的本质是相同的。示例如下(这里的result变量的类型不是函数类型，而与后面的匿名函数的结果类型是相同的)：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> result = <span class="function"><span class="keyword">func</span><span class="params">(part1 <span class="keyword">string</span>, part2 <span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> part1 + part2</span><br><span class="line">&#125;(<span class="string">&quot;1&quot;</span>, <span class="string">&quot;2&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>方法就是一个包含了接受者的函数，接受者可以是命名类型或者结构体类型的一个值或者是一个指针。所有给定类型的方法属于该类型的方法集。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(variable_name variable_data_type)</span> <span class="title">function_name</span><span class="params">()</span> [<span class="title">return_type</span>]</span>&#123;</span><br><span class="line">	<span class="comment">/* 函数体*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 定义结构体 */</span></span><br><span class="line"><span class="keyword">type</span> Circle <span class="keyword">struct</span> &#123;</span><br><span class="line">	radius <span class="keyword">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> c1 Circle</span><br><span class="line">	c1.radius = <span class="number">10.00</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;圆的面积 = &quot;</span>, c1.getArea())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//该 method 属于 Circle 类型对象中的方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Circle)</span> <span class="title">getArea</span><span class="params">()</span> <span class="title">float64</span></span> &#123;</span><br><span class="line">	<span class="comment">//c.radius 即为 Circle 类型对象中的属性</span></span><br><span class="line">	<span class="keyword">return</span> <span class="number">3.14</span> * c.radius * c.radius</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h1><h2 id="bool"><a href="#bool" class="headerlink" title="bool"></a>bool</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> b <span class="keyword">bool</span> = <span class="literal">true</span>/<span class="literal">false</span></span><br></pre></td></tr></table></figure>

<h2 id="数字类型"><a href="#数字类型" class="headerlink" title="数字类型"></a>数字类型</h2><ul>
<li>uint: 32或64位</li>
<li>int: 同于uint</li>
<li>uint8</li>
<li>uint16</li>
<li>uint32</li>
<li>uint64</li>
<li>int8</li>
<li>int16</li>
<li>int32</li>
<li>int64</li>
<li>float32</li>
<li>float64</li>
<li>complex64: 32位实数和虚数</li>
<li>complex128: 64位实数和虚数</li>
<li>byte: 类似uint8</li>
<li>rune: 类似int32</li>
<li>uintptr: 无符号整型，用于存放一个指针</li>
</ul>
<h2 id="字符串类型"><a href="#字符串类型" class="headerlink" title="字符串类型"></a>字符串类型</h2><p>string：Go的字符串是由单个字节连接起来的。Go语言的字符串的字节使用UTF-8编码标识Unicode文本。</p>
<h2 id="数组类型"><a href="#数组类型" class="headerlink" title="数组类型"></a>数组类型</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> variable_name [SIZE] variable_type</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> balance = [<span class="number">5</span>]<span class="keyword">float32</span>&#123;<span class="number">1000.0</span>, <span class="number">2.0</span>, <span class="number">3.4</span>, <span class="number">7.0</span>, <span class="number">50.0</span>&#125;</span><br></pre></td></tr></table></figure>

<p>如果忽略 [] 中的数字不设置数组大小，Go 语言会根据元素的个数来设置数组的大小：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> balance = [...]<span class="keyword">float32</span>&#123;<span class="number">1000.0</span>, <span class="number">2.0</span>, <span class="number">3.4</span>, <span class="number">7.0</span>, <span class="number">50.0</span>&#125;</span><br></pre></td></tr></table></figure>

<p>多维数组：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> variable_name [SIZE1][SIZE2]...[SIZEN] variable_type</span><br></pre></td></tr></table></figure>

<p>初始化二维数组：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">3</span>][<span class="number">4</span>]<span class="keyword">int</span>&#123;  </span><br><span class="line">	&#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125; ,   <span class="comment">/*  第一行索引为 0 */</span></span><br><span class="line">	&#123;<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>&#125; ,   <span class="comment">/*  第二行索引为 1 */</span></span><br><span class="line">	&#123;<span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>&#125;,   <span class="comment">/* 第三行索引为 2 */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>向函数传递数组：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 形参设定数组大小：</span></span><br><span class="line">void myFunction(param [<span class="number">10</span>]<span class="keyword">int</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 形参未设定数组大小：</span></span><br><span class="line">void myFunction(param []<span class="keyword">int</span>)</span><br></pre></td></tr></table></figure>

<h2 id="指针"><a href="#指针" class="headerlink" title="指针"></a>指针</h2><p>空指针为nil，指代零值或空值。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> var_name *<span class="keyword">var</span>-<span class="keyword">type</span></span><br><span class="line"><span class="comment">// 指针数组</span></span><br><span class="line"><span class="keyword">var</span> var_name [<span class="number">5</span>]*<span class="keyword">var</span>-<span class="keyword">type</span></span><br><span class="line"><span class="comment">// 指向指针的指针</span></span><br><span class="line"><span class="keyword">var</span> var_name **<span class="keyword">var</span>-<span class="keyword">type</span></span><br></pre></td></tr></table></figure>

<p>指针作为函数参数：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">/* 定义局部变量 */</span></span><br><span class="line">	<span class="keyword">var</span> a <span class="keyword">int</span> = <span class="number">100</span></span><br><span class="line">	<span class="keyword">var</span> b <span class="keyword">int</span>= <span class="number">200</span></span><br><span class="line"></span><br><span class="line">	fmt.Printf(<span class="string">&quot;交换前 a 的值 : %d\n&quot;</span>, a )</span><br><span class="line">	fmt.Printf(<span class="string">&quot;交换前 b 的值 : %d\n&quot;</span>, b )</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* 调用函数用于交换值</span></span><br><span class="line"><span class="comment">	* &amp;a 指向 a 变量的地址</span></span><br><span class="line"><span class="comment">	* &amp;b 指向 b 变量的地址</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	swap(&amp;a, &amp;b);</span><br><span class="line"></span><br><span class="line">	fmt.Printf(<span class="string">&quot;交换后 a 的值 : %d\n&quot;</span>, a )</span><br><span class="line">	fmt.Printf(<span class="string">&quot;交换后 b 的值 : %d\n&quot;</span>, b )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">swap</span><span class="params">(x *<span class="keyword">int</span>, y *<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> temp <span class="keyword">int</span></span><br><span class="line">	temp = *x    <span class="comment">/* 保存 x 地址的值 */</span></span><br><span class="line">	*x = *y      <span class="comment">/* 将 y 赋值给 x */</span></span><br><span class="line">	*y = temp    <span class="comment">/* 将 temp 赋值给 y */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="结构体类型"><a href="#结构体类型" class="headerlink" title="结构体类型"></a>结构体类型</h2><p>用法：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> struct_variable_type <span class="keyword">struct</span> &#123;</span><br><span class="line">	member definition;</span><br><span class="line">	member definition;</span><br><span class="line">	...</span><br><span class="line">	member definition;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable_name := structure_variable_type &#123;value1, value2...valuen&#125;</span><br><span class="line"><span class="comment">// 或</span></span><br><span class="line">variable_name := structure_variable_type &#123; key1: value1, key2: value2..., keyn: valuen&#125;</span><br></pre></td></tr></table></figure>

<p>访问时通过<code>.</code>操作访问结构体成员。</p>
<h2 id="切片类型"><a href="#切片类型" class="headerlink" title="切片类型"></a>切片类型</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 声明一个未指定大小的数组来定义切片：</span></span><br><span class="line"><span class="keyword">var</span> identifier []<span class="keyword">type</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用make()函数来创建切片:</span></span><br><span class="line"><span class="keyword">var</span> slice1 []<span class="keyword">type</span> = <span class="built_in">make</span>([]<span class="keyword">type</span>, <span class="built_in">len</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 也可以简写为：</span></span><br><span class="line">slice1 := <span class="built_in">make</span>([]<span class="keyword">type</span>, <span class="built_in">len</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 也可以指定容量，其中capacity为可选参数。</span></span><br><span class="line"><span class="built_in">make</span>([]T, length, capacity)</span><br><span class="line"><span class="comment">// 这里 len 是数组的长度并且也是切片的初始长度。</span></span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">s :=[] <span class="keyword">int</span> &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span> &#125; </span><br><span class="line"><span class="comment">// 直接初始化切片，[]表示是切片类型，&#123;1,2,3&#125;初始化值依次是1,2,3.其cap=len=3</span></span><br><span class="line"></span><br><span class="line">s := arr[:] </span><br><span class="line"><span class="comment">// 初始化切片s,是数组arr的引用</span></span><br><span class="line"></span><br><span class="line">s := arr[startIndex:endIndex] </span><br><span class="line"><span class="comment">// 将arr中从下标startIndex到endIndex-1 下的元素创建为一个新的切片</span></span><br><span class="line"></span><br><span class="line">s := arr[startIndex:] </span><br><span class="line"><span class="comment">// 缺省endIndex时将表示一直到arr的最后一个元素</span></span><br><span class="line"></span><br><span class="line">s := arr[:endIndex] </span><br><span class="line"><span class="comment">// 缺省startIndex时将表示从arr的第一个元素开始</span></span><br><span class="line"></span><br><span class="line">s1 := s[startIndex:endIndex] </span><br><span class="line"><span class="comment">// 通过切片s初始化切片s1</span></span><br><span class="line"></span><br><span class="line">s :=<span class="built_in">make</span>([]<span class="keyword">int</span>,<span class="built_in">len</span>,<span class="built_in">cap</span>) </span><br><span class="line"><span class="comment">// 通过内置函数make()初始化切片s,[]int 标识为其元素类型为int的切片</span></span><br></pre></td></tr></table></figure>

<ul>
<li>切片是可索引的，并且可以由 len() 方法获取长度。切片提供了计算容量的方法 cap() 可以测量切片最长可以达到多少。</li>
<li>一个切片在未初始化之前默认为 nil，长度为 0.</li>
<li>对于底层数组容量是 k 的切片 slice[i:j] 来说：长度: j-i;容量: k-i.</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> numbers []<span class="keyword">int</span></span><br><span class="line"></span><br><span class="line">	printSlice(numbers)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(numbers == <span class="literal">nil</span>)&#123;</span><br><span class="line">	  fmt.Printf(<span class="string">&quot;切片是空的&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printSlice</span><span class="params">(x []<span class="keyword">int</span>)</span></span>&#123;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;len=%d cap=%d slice=%v\n&quot;</span>,<span class="built_in">len</span>(x),<span class="built_in">cap</span>(x),x)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 以上实例运行输出结果为:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// len=0 cap=0 slice=[]</span></span><br><span class="line"><span class="comment">// 切片是空的</span></span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">/* 创建切片 */</span></span><br><span class="line">	numbers := []<span class="keyword">int</span>&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>&#125;   </span><br><span class="line">	printSlice(numbers)	<span class="comment">// len=9 cap=9 slice=[0 1 2 3 4 5 6 7 8]</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/* 打印原始切片 */</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;numbers ==&quot;</span>, numbers)	<span class="comment">// numbers == [0 1 2 3 4 5 6 7 8]</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/* 打印子切片从索引1(包含) 到索引4(不包含)*/</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;numbers[1:4] ==&quot;</span>, numbers[<span class="number">1</span>:<span class="number">4</span>])	<span class="comment">// numbers[1:4] == [1 2 3]</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/* 默认下限为 0*/</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;numbers[:3] ==&quot;</span>, numbers[:<span class="number">3</span>])	<span class="comment">// numbers[:3] == [0 1 2]</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/* 默认上限为 len(s)*/</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;numbers[4:] ==&quot;</span>, numbers[<span class="number">4</span>:])	<span class="comment">// numbers[4:] == [4 5 6 7 8]</span></span><br><span class="line"></span><br><span class="line">	numbers1 := <span class="built_in">make</span>([]<span class="keyword">int</span>,<span class="number">0</span>,<span class="number">5</span>)</span><br><span class="line">	printSlice(numbers1)	<span class="comment">// len=0 cap=5 slice=[]</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/* 打印子切片从索引  0(包含) 到索引 2(不包含) */</span></span><br><span class="line">	number2 := numbers[:<span class="number">2</span>]</span><br><span class="line">	printSlice(number2)	<span class="comment">// len=2 cap=9 slice=[0 1]</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/* 打印子切片从索引 2(包含) 到索引 5(不包含) */</span></span><br><span class="line">	number3 := numbers[<span class="number">2</span>:<span class="number">5</span>]</span><br><span class="line">	printSlice(number3)	<span class="comment">// len=3 cap=7 slice=[2 3 4]</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printSlice</span><span class="params">(x []<span class="keyword">int</span>)</span></span>&#123;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;len=%d cap=%d slice=%v\n&quot;</span>,<span class="built_in">len</span>(x),<span class="built_in">cap</span>(x),x)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>append的用法有两种：</p>
<ul>
<li>slice = append(slice, elem1, elem2)</li>
<li>slice = append(slice, anotherSlice…)</li>
</ul>
<p>append要点：</p>
<ul>
<li>用append把一个或多个元素添加在一个slice的后面；</li>
<li>append的slice有一个underlying array，此即slice和array的关系；</li>
<li>另外slice有一个length和capability的概念；</li>
<li>如果slice还有剩余的空间，可以添加这些新元素，那么append就将新的元素放在slice后面的空余空间中；</li>
<li>如果slice的空间不足以放下新增的元素，那么就需要重现创建一个数组；这时可能是alloc、也可能是realloc的方式分配这个新的数组；也就是说，这个新的slice可能和之前的slice在同一个起始地址上，也可能不是一个新的地址。——通常而言，是一个新的地址。</li>
<li>分配了新的地址之后，再把原来slice中的元素逐个拷贝到新的slice中，并返回。</li>
<li>当一个append执行达到了切片的容量，它会自动扩容为原来的两倍大小</li>
</ul>
<p>copy用法：</p>
<ul>
<li>copy(to_slide, from_slide)</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> numbers []<span class="keyword">int</span></span><br><span class="line">	printSlice(numbers) <span class="comment">// len=0 cap=0 slice=[]</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/* 允许追加空切片 */</span></span><br><span class="line">	numbers = <span class="built_in">append</span>(numbers, <span class="number">0</span>) <span class="comment">// len=1 cap=1 slice=[0]</span></span><br><span class="line">	printSlice(numbers)</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* 向切片添加一个元素 */</span></span><br><span class="line">	numbers = <span class="built_in">append</span>(numbers, <span class="number">1</span>)</span><br><span class="line">	printSlice(numbers) <span class="comment">// len=2 cap=2 slice=[0 1]</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/* 同时添加多个元素 */</span></span><br><span class="line">	numbers = <span class="built_in">append</span>(numbers, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">	printSlice(numbers) <span class="comment">// len=5 cap=6 slice=[0 1 2 3 4]</span></span><br><span class="line"></span><br><span class="line">	numbers = <span class="built_in">append</span>(numbers, <span class="number">5</span>, <span class="number">6</span>)</span><br><span class="line">	printSlice(numbers) <span class="comment">// len=7 cap=12 slice=[0 1 2 3 4 5 6]</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/* 创建切片 numbers1 是之前切片的两倍容量*/</span></span><br><span class="line">	numbers1 := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="built_in">len</span>(numbers), (<span class="built_in">cap</span>(numbers))*<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* 拷贝 numbers 的内容到 numbers1 */</span></span><br><span class="line">	<span class="built_in">copy</span>(numbers1, numbers)</span><br><span class="line">	printSlice(numbers1) <span class="comment">// len=7 cap=24 slice=[0 1 2 3 4 5 6]</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printSlice</span><span class="params">(x []<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;len=%d cap=%d slice=%v\n&quot;</span>, <span class="built_in">len</span>(x), <span class="built_in">cap</span>(x), x)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Range"><a href="#Range" class="headerlink" title="Range"></a>Range</h2><p>range 关键字用于 for 循环中迭代数组(array)、切片(slice)、通道(channel)或集合(map)的元素。在数组和切片中它返回元素的索引和索引对应的值，在集合中返回 key-value 对的 key 值。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">//这是我们使用range去求一个slice的和。使用数组跟这个很类似</span></span><br><span class="line">	nums := []<span class="keyword">int</span>&#123;<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;</span><br><span class="line">	sum := <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> _, num := <span class="keyword">range</span> nums &#123;</span><br><span class="line">		sum += num</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">&quot;sum:&quot;</span>, sum)</span><br><span class="line">	<span class="comment">//在数组上使用range将传入index和值两个变量。上面那个例子我们不需要使用该元素的序号，所以我们使用空白符&quot;_&quot;省略了。有时侯我们确实需要知道它的索引。</span></span><br><span class="line">	<span class="keyword">for</span> i, num := <span class="keyword">range</span> nums &#123;</span><br><span class="line">		<span class="keyword">if</span> num == <span class="number">3</span> &#123;</span><br><span class="line">			fmt.Println(<span class="string">&quot;index:&quot;</span>, i)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//range也可以用在map的键值对上。</span></span><br><span class="line">	kvs := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>&#123;<span class="string">&quot;a&quot;</span>: <span class="string">&quot;apple&quot;</span>, <span class="string">&quot;b&quot;</span>: <span class="string">&quot;banana&quot;</span>&#125;</span><br><span class="line">	<span class="keyword">for</span> k, v := <span class="keyword">range</span> kvs &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;%s -&gt; %s\n&quot;</span>, k, v)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//range也可以用来枚举Unicode字符串。第一个参数是字符的索引，第二个是字符（Unicode的值）本身。</span></span><br><span class="line">	<span class="keyword">for</span> i, c := <span class="keyword">range</span> <span class="string">&quot;go&quot;</span> &#123;</span><br><span class="line">		fmt.Println(i, c)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Map类型"><a href="#Map类型" class="headerlink" title="Map类型"></a>Map类型</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 声明变量，默认 map 是 nil */</span></span><br><span class="line"><span class="keyword">var</span> map_variable <span class="keyword">map</span>[key_data_type]value_data_type</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 使用 make 函数 */</span></span><br><span class="line">map_variable := <span class="built_in">make</span>(<span class="keyword">map</span>[key_data_type]value_data_type)</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> countryCapitalMap <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span> <span class="comment">/*创建集合 */</span></span><br><span class="line">	countryCapitalMap = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* map插入key - value对,各个国家对应的首都 */</span></span><br><span class="line">	countryCapitalMap [ <span class="string">&quot;France&quot;</span> ] = <span class="string">&quot;Paris&quot;</span></span><br><span class="line">	countryCapitalMap [ <span class="string">&quot;Italy&quot;</span> ] = <span class="string">&quot;罗马&quot;</span></span><br><span class="line">	countryCapitalMap [ <span class="string">&quot;Japan&quot;</span> ] = <span class="string">&quot;东京&quot;</span></span><br><span class="line">	countryCapitalMap [ <span class="string">&quot;India &quot;</span> ] = <span class="string">&quot;新德里&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/*使用键输出地图值 */</span> </span><br><span class="line">	<span class="keyword">for</span> country := <span class="keyword">range</span> countryCapitalMap &#123;</span><br><span class="line">		fmt.Println(country, <span class="string">&quot;首都是&quot;</span>, countryCapitalMap [country])</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*查看元素在集合中是否存在 */</span></span><br><span class="line">	captial, ok := countryCapitalMap [ <span class="string">&quot;美国&quot;</span> ] <span class="comment">/*如果确定是真实的,则存在,否则不存在 */</span></span><br><span class="line">	<span class="comment">/*fmt.Println(captial) */</span></span><br><span class="line">	<span class="comment">/*fmt.Println(ok) */</span></span><br><span class="line">	<span class="keyword">if</span> (ok) &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;美国的首都是&quot;</span>, captial)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;美国的首都不存在&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>delete() 函数用于删除集合的元素, 参数为 map 和其对应的 key。实例如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">/* 创建map */</span></span><br><span class="line">	countryCapitalMap := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>&#123;<span class="string">&quot;France&quot;</span>: <span class="string">&quot;Paris&quot;</span>, <span class="string">&quot;Italy&quot;</span>: <span class="string">&quot;Rome&quot;</span>, <span class="string">&quot;Japan&quot;</span>: <span class="string">&quot;Tokyo&quot;</span>, <span class="string">&quot;India&quot;</span>: <span class="string">&quot;New delhi&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">&quot;原始地图&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* 打印地图 */</span></span><br><span class="line">	<span class="keyword">for</span> country := <span class="keyword">range</span> countryCapitalMap &#123;</span><br><span class="line">		fmt.Println(country, <span class="string">&quot;首都是&quot;</span>, countryCapitalMap [ country ])</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*删除元素*/</span> <span class="built_in">delete</span>(countryCapitalMap, <span class="string">&quot;France&quot;</span>)</span><br><span class="line">	fmt.Println(<span class="string">&quot;法国条目被删除&quot;</span>)</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">&quot;删除元素后地图&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*打印地图*/</span></span><br><span class="line">	<span class="keyword">for</span> country := <span class="keyword">range</span> countryCapitalMap &#123;</span><br><span class="line">		fmt.Println(country, <span class="string">&quot;首都是&quot;</span>, countryCapitalMap [ country ])</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="List"><a href="#List" class="headerlink" title="List"></a>List</h2><p>包含于conatiner/list包中。</p>
<p>初始化：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. New方法初始化list</span></span><br><span class="line">变量名 := list.New()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 通过声明初始化list</span></span><br><span class="line"><span class="keyword">var</span> 变量名 list.List</span><br></pre></td></tr></table></figure>

<p>添加元素：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 追加新元素到末尾，返回该元素指针</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *List)</span> <span class="title">PushBack</span><span class="params">(v <span class="keyword">interface</span>&#123;&#125;)</span> *<span class="title">Element</span></span></span><br><span class="line"><span class="comment">// 追加另一个列表到末尾</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *List)</span> <span class="title">PushBackList</span><span class="params">(other *List)</span></span></span><br><span class="line"><span class="comment">// 添加新元素到开头，返回该元素指针</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *List)</span> <span class="title">PushFront</span><span class="params">(v <span class="keyword">interface</span>&#123;&#125;)</span> *<span class="title">Element</span></span></span><br><span class="line"><span class="comment">// 添加另一个列表到开头</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *List)</span> <span class="title">PushFrontList</span><span class="params">(other *List)</span></span></span><br><span class="line"><span class="comment">// 在mark后面插入新元素，返回新元素指针</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *List)</span> <span class="title">InsertAfter</span><span class="params">(v <span class="keyword">interface</span>&#123;&#125;, mark *Element)</span> *<span class="title">Element</span></span></span><br><span class="line"><span class="comment">// 在mark前插入新元素，返回新元素指针</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *List)</span> <span class="title">InsertBefore</span><span class="params">(v <span class="keyword">interface</span>&#123;&#125;, mark *Element)</span> *<span class="title">Element</span></span></span><br></pre></td></tr></table></figure>

<p>移动元素：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 移动e到mark之后</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *List)</span> <span class="title">MoveAfter</span><span class="params">(e, mark *Element)</span></span></span><br><span class="line"><span class="comment">// 移动e到mark之前</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *List)</span> <span class="title">MoveBefore</span><span class="params">(e, mark *Element)</span></span></span><br><span class="line"><span class="comment">// 移动e到末尾</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *List)</span> <span class="title">MoveToBack</span><span class="params">(e *Element)</span></span></span><br><span class="line"><span class="comment">// 移动e到开头</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *List)</span> <span class="title">MoveToFront</span><span class="params">(e *Element)</span></span></span><br></pre></td></tr></table></figure>

<p>访问元素：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回结尾元素</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *List)</span> <span class="title">Back</span><span class="params">()</span> *<span class="title">Element</span></span></span><br><span class="line"><span class="comment">// 返回开头元素</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *List)</span> <span class="title">Front</span><span class="params">()</span> *<span class="title">Element</span></span></span><br></pre></td></tr></table></figure>

<p>遍历列表：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回下一个元素，如果没有下一个元素，返回nil</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e *Element)</span> <span class="title">Next</span><span class="params">()</span> *<span class="title">Element</span></span></span><br><span class="line"><span class="comment">// 返回前一个元素，如果没有前一个元素，返回nil</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e *Element)</span> <span class="title">Prev</span><span class="params">()</span> *<span class="title">Element</span></span></span><br></pre></td></tr></table></figure>

<p>获取列表长度：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *List)</span> <span class="title">Len</span><span class="params">()</span> <span class="title">int</span></span></span><br></pre></td></tr></table></figure>

<p>移除元素：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 移除e，返回e的值</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *List)</span> <span class="title">Remove</span><span class="params">(e *Element)</span> <span class="title">interface</span></span>&#123;&#125;</span><br><span class="line"><span class="comment">// 清空列表</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *List)</span> <span class="title">Init</span><span class="params">()</span> *<span class="title">List</span></span></span><br></pre></td></tr></table></figure>

<h2 id="interface类型"><a href="#interface类型" class="headerlink" title="interface类型"></a>interface类型</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 定义接口 */</span></span><br><span class="line"><span class="keyword">type</span> interface_name <span class="keyword">interface</span> &#123;</span><br><span class="line">	method_name1 [return_type]</span><br><span class="line">	method_name2 [return_type]</span><br><span class="line">	method_name3 [return_type]</span><br><span class="line">	...</span><br><span class="line">	method_namen [return_type]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 定义结构体 */</span></span><br><span class="line"><span class="keyword">type</span> struct_name <span class="keyword">struct</span> &#123;</span><br><span class="line">	<span class="comment">/* variables */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 实现接口方法 */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(struct_name_variable struct_name)</span> <span class="title">method_name1</span><span class="params">()</span> [<span class="title">return_type</span>]</span> &#123;</span><br><span class="line">	<span class="comment">/* 方法实现 */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(struct_name_variable struct_name)</span> <span class="title">method_namen</span><span class="params">()</span> [<span class="title">return_type</span>]</span> &#123;</span><br><span class="line">	<span class="comment">/* 方法实现*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Phone <span class="keyword">interface</span> &#123;</span><br><span class="line">	call()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> NokiaPhone <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(nokiaPhone NokiaPhone)</span> <span class="title">call</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;I am Nokia, I can call you!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> IPhone <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(iPhone IPhone)</span> <span class="title">call</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;I am iPhone, I can call you!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> phone Phone</span><br><span class="line"></span><br><span class="line">	phone = <span class="built_in">new</span>(NokiaPhone)</span><br><span class="line">	phone.call()</span><br><span class="line"></span><br><span class="line">	phone = <span class="built_in">new</span>(IPhone)</span><br><span class="line">	phone.call()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Channel类型"><a href="#Channel类型" class="headerlink" title="Channel类型"></a>Channel类型</h2><h3 id="Channel创建"><a href="#Channel创建" class="headerlink" title="Channel创建"></a>Channel创建</h3><p>channel 使用内置的 make 函数创建:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br></pre></td></tr></table></figure>

<h3 id="Channel读写"><a href="#Channel读写" class="headerlink" title="Channel读写"></a>Channel读写</h3><p>channel的读写操作(channel 一定要初始化后才能进行读写操作，否则会永久阻塞):</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// write to channel</span></span><br><span class="line">ch &lt;- x</span><br><span class="line"></span><br><span class="line"><span class="comment">// read from channel</span></span><br><span class="line">x &lt;- ch</span><br><span class="line"></span><br><span class="line"><span class="comment">// another way to read</span></span><br><span class="line">x = &lt;- ch</span><br><span class="line"></span><br><span class="line">value, ok := &lt;- ch1</span><br></pre></td></tr></table></figure>

<p>这里的变量ok的值同样是bool类型的。它代表了通道值的状态，true代表通道值有效，而false则代表通道值已无效（或称已关闭）。如果在接收操作进行之前或过程中通道值被关闭了，则接收操作会立即结束并返回一个该通道值的元素类型的零值。</p>
<h3 id="Channel关闭"><a href="#Channel关闭" class="headerlink" title="Channel关闭"></a>Channel关闭</h3><p>golang 提供了内置的 close 函数对 channel 进行关闭操作。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line"><span class="built_in">close</span>(ch)</span><br></pre></td></tr></table></figure>

<ul>
<li>关闭一个未初始化(nil) 的 channel 会产生 panic</li>
<li>重复关闭同一个 channel 会产生 panic</li>
<li>向一个已关闭的 channel 中发送消息会产生 panic</li>
<li>从已关闭的 channel 读取消息不会产生 panic，且能读出 channel 中还未被读取的消息，若消息均已读出，则会读到类型的零值。从一个已关闭的 channel 中读取消息永远不会阻塞，并且会返回一个为 false 的 ok-idiom，可以用它来判断 channel 是否关闭</li>
<li>关闭 channel 会产生一个广播机制，所有向 channel 读取消息的 goroutine 都会收到消息</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">10</span>)</span><br><span class="line">ch &lt;- <span class="number">11</span></span><br><span class="line">ch &lt;- <span class="number">12</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">close</span>(ch)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x := <span class="keyword">range</span> ch &#123;</span><br><span class="line">    fmt.Println(x)	<span class="comment">// 11	12</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">x, ok := &lt;- ch</span><br><span class="line">fmt.Println(x, ok)	<span class="comment">// 0 false</span></span><br></pre></td></tr></table></figure>

<h3 id="无缓存的-channel"><a href="#无缓存的-channel" class="headerlink" title="无缓存的 channel"></a>无缓存的 channel</h3><p>从无缓存的 channel 中读取消息会阻塞，直到有 goroutine 向该 channel 中发送消息；同理，向无缓存的 channel 中发送消息也会阻塞，直到有 goroutine 从 channel 中读取消息。</p>
<p>非缓冲的通道值的初始化方法如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h3 id="有缓存的-channel"><a href="#有缓存的-channel" class="headerlink" title="有缓存的 channel"></a>有缓存的 channel</h3><p>有缓存的 channel 的声明方式为指定 make 函数的第二个参数，该参数为 channel 缓存的容量</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">10</span>)</span><br></pre></td></tr></table></figure>

<p>有缓存的 channel 类似一个阻塞队列(采用环形数组实现)。当缓存未满时，向 channel 中发送消息时不会阻塞，当缓存满时，发送操作将被阻塞，直到有其他 goroutine 从中读取消息；相应的，当 channel 中消息不为空时，读取消息不会出现阻塞，当 channel 为空时，读取操作会造成阻塞，直到有 goroutine 向 channel 中写入消息。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// blocked, read from empty buffered channel</span></span><br><span class="line">&lt;- ch</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">3</span>)</span><br><span class="line">ch &lt;- <span class="number">1</span></span><br><span class="line">ch &lt;- <span class="number">2</span></span><br><span class="line">ch &lt;- <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// blocked, send to full buffered channel</span></span><br><span class="line">ch &lt;- <span class="number">4</span></span><br></pre></td></tr></table></figure>

<p>通过 len 函数可以获得 chan 中的元素个数，通过 cap 函数可以得到 channel 的缓存长度。</p>
<h3 id="双向-单向Channel"><a href="#双向-单向Channel" class="headerlink" title="双向/单向Channel"></a>双向/单向Channel</h3><p>默认情况下，通道都是双向的，即双向通道。如果数据只能在通道中单向传输，那么该通道就被称作单向通道。在编写类型声明的时候可以这样做：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Receiver &lt;-<span class="keyword">chan</span> <span class="keyword">int</span></span><br></pre></td></tr></table></figure>

<p>类型Receiver代表了一个只可从中接收数据的单向通道类型。这样的通道也被称为接收通道。在关键字chan左边的接收操作符&lt;-形象地表示出了数据的流向。相对应的，如果想声明一个发送通道类型，那么应该这样：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Sender <span class="keyword">chan</span>&lt;- <span class="keyword">int</span></span><br></pre></td></tr></table></figure>

<p>可以把一个双向通道值赋予上述类型的变量：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myChannel = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">3</span>)</span><br><span class="line"><span class="keyword">var</span> sender Sender = myChannel</span><br><span class="line"><span class="keyword">var</span> receiver Receiver = myChannel  </span><br><span class="line"></span><br><span class="line"><span class="comment">//但是，反之则是不行的。像下面这样的代码是通不过编译的：</span></span><br><span class="line"><span class="keyword">var</span> myChannel1 <span class="keyword">chan</span> <span class="keyword">int</span> = sender</span><br></pre></td></tr></table></figure>

<p>单向通道的主要作用是约束程序对通道值的使用方式。</p>
<h3 id="channel应用"><a href="#channel应用" class="headerlink" title="channel应用"></a>channel应用</h3><h4 id="广播功能实现"><a href="#广播功能实现" class="headerlink" title="广播功能实现"></a>广播功能实现</h4><p>当一个通道关闭时, 所有对此通道的读取的goroutine都会退出阻塞。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;fmt&quot;</span></span><br><span class="line">   <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">notify</span><span class="params">(id <span class="keyword">int</span>, channel <span class="keyword">chan</span> <span class="keyword">int</span>)</span></span>&#123;</span><br><span class="line">   &lt;-channel<span class="comment">//接收到数据或通道关闭时退出阻塞</span></span><br><span class="line">   fmt.Printf(<span class="string">&quot;%d receive a message.\n&quot;</span>, id)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">broadcast</span><span class="params">(channel <span class="keyword">chan</span> <span class="keyword">int</span>)</span></span>&#123;</span><br><span class="line">   fmt.Printf(<span class="string">&quot;Broadcast:\n&quot;</span>)</span><br><span class="line">   <span class="built_in">close</span>(channel)<span class="comment">//关闭通道&#125;</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">   channel := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>,<span class="number">1</span>)</span><br><span class="line">   <span class="keyword">for</span> i:=<span class="number">0</span>;i&lt;<span class="number">10</span> ;i++  &#123;</span><br><span class="line">      <span class="keyword">go</span> notify(i,channel)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">go</span> broadcast(channel)</span><br><span class="line">   time.Sleep(time.Second)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="select使用"><a href="#select使用" class="headerlink" title="select使用"></a>select使用</h4><p>select用于在多个channel上同时进行侦听并收发消息，当任何一个case满足条件时即执行，如果没有可执行的case则会执行default的case，如果没有指定default case，则会阻塞程序。select的语法如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line"><span class="keyword">case</span> communication clause :</span><br><span class="line">   statement(s);</span><br><span class="line"><span class="keyword">case</span> communication clause :</span><br><span class="line">   statement(s);   <span class="comment">/*可以定义任意数量的 case */</span><span class="keyword">default</span> : <span class="comment">/*可选 */</span></span><br><span class="line">   statement(s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Select多路复用中：</p>
<ul>
<li>每个case都必须是一次通信</li>
<li>所有channel表达式都会被求值</li>
<li>所有被发送的表达式都会被求值</li>
<li>如果任意某个通信可以进行，它就执行；其它被忽略。</li>
<li>如果有多个case都可以运行，Select会随机公平地选出一个执行。其它不会执行。</li>
<li>否则，如果有default子句，则执行default语句。如果没有default子句，select将阻塞，直到某个通信可以运行；Go不会重新对channel或值进行求值。</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> mainimport (</span><br><span class="line">   <span class="string">&quot;fmt&quot;</span></span><br><span class="line">   <span class="string">&quot;time&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">doWork</span><span class="params">(channels *[10]<span class="keyword">chan</span> <span class="keyword">int</span>)</span></span>&#123;</span><br><span class="line">     <span class="keyword">for</span> &#123;</span><br><span class="line">       <span class="keyword">select</span> &#123;</span><br><span class="line">       <span class="keyword">case</span> x1 := &lt;-channels[<span class="number">0</span>]:</span><br><span class="line">         fmt.Println(<span class="string">&quot;receive x1: &quot;</span>,x1)</span><br><span class="line">       <span class="keyword">case</span> x2 := &lt;-channels[<span class="number">1</span>]:</span><br><span class="line">         fmt.Println(<span class="string">&quot;receive x2: &quot;</span>,x2)</span><br><span class="line">       <span class="keyword">case</span> x3 := &lt;-channels[<span class="number">2</span>]:</span><br><span class="line">         fmt.Println(<span class="string">&quot;receive x3: &quot;</span>,x3)</span><br><span class="line">       <span class="keyword">case</span> x4 := &lt;-channels[<span class="number">3</span>]:</span><br><span class="line">         fmt.Println(<span class="string">&quot;receive x4: &quot;</span>,x4)</span><br><span class="line">       <span class="keyword">case</span> x5 := &lt;-channels[<span class="number">4</span>]:</span><br><span class="line">         fmt.Println(<span class="string">&quot;receive x5: &quot;</span>,x5)</span><br><span class="line">       <span class="keyword">case</span> x6 := &lt;-channels[<span class="number">5</span>]:</span><br><span class="line">         fmt.Println(<span class="string">&quot;receive x6: &quot;</span>,x6)</span><br><span class="line">       <span class="keyword">case</span> x7 := &lt;-channels[<span class="number">6</span>]:</span><br><span class="line">         fmt.Println(<span class="string">&quot;receive x7: &quot;</span>,x7)</span><br><span class="line">       <span class="keyword">case</span> x8 := &lt;-channels[<span class="number">7</span>]:</span><br><span class="line">         fmt.Println(<span class="string">&quot;receive x8: &quot;</span>,x8)</span><br><span class="line">       <span class="keyword">case</span> x9 := &lt;-channels[<span class="number">8</span>]:</span><br><span class="line">         fmt.Println(<span class="string">&quot;receive x9: &quot;</span>,x9)</span><br><span class="line">       <span class="keyword">case</span> x10 := &lt;-channels[<span class="number">9</span>]:</span><br><span class="line">         fmt.Println(<span class="string">&quot;receive x10: &quot;</span>,x10)</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">   <span class="keyword">var</span> channels [<span class="number">10</span>]<span class="keyword">chan</span> <span class="keyword">int</span></span><br><span class="line">   <span class="keyword">go</span> doWork(&amp;channels)</span><br><span class="line">   <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">      channels[i] = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>,<span class="number">1</span>)</span><br><span class="line">      channels[i]&lt;- i</span><br><span class="line">   &#125;</span><br><span class="line">   time.Sleep(time.Second*<span class="number">5</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 结果如下：</span></span><br><span class="line">receive x4:  <span class="number">3</span></span><br><span class="line">receive x10:  <span class="number">9</span></span><br><span class="line">receive x9:  <span class="number">8</span></span><br><span class="line">receive x5:  <span class="number">4</span></span><br><span class="line">receive x2:  <span class="number">1</span></span><br><span class="line">receive x7:  <span class="number">6</span></span><br><span class="line">receive x8:  <span class="number">7</span></span><br><span class="line">receive x1:  <span class="number">0</span></span><br><span class="line">receive x3:  <span class="number">2</span></span><br><span class="line">receive x6:  <span class="number">5</span></span><br></pre></td></tr></table></figure>

<h2 id="类型转换"><a href="#类型转换" class="headerlink" title="类型转换"></a>类型转换</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">type_name(expression)</span><br></pre></td></tr></table></figure>

<h1 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h1><h2 id="error"><a href="#error" class="headerlink" title="error"></a>error</h2><p>Go 语言通过内置的错误接口提供了非常简单的错误处理机制。error类型是一个接口类型，这是它的定义：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> error <span class="keyword">interface</span> &#123;</span><br><span class="line">	Error() <span class="keyword">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> errors</span><br><span class="line"></span><br><span class="line"><span class="comment">// New returns an error that formats as the given text.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">New</span><span class="params">(text <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;errorString&#123;text&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// errorString is a trivial implementation of error.</span></span><br><span class="line"><span class="keyword">type</span> errorString <span class="keyword">struct</span> &#123;</span><br><span class="line">	s <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e *errorString)</span> <span class="title">Error</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> e.s</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们可以在编码中通过实现 error 接口类型来生成错误信息。函数通常在最后的返回值中返回错误信息。使用errors.New 可返回一个错误信息：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Sqrt</span><span class="params">(f <span class="keyword">float64</span>)</span> <span class="params">(<span class="keyword">float64</span>, error)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> f &lt; <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, errors.New(<span class="string">&quot;math: square root of negative number&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 实现</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	result, err:= Sqrt(<span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>自定义：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义一个 DivideError 结构</span></span><br><span class="line"><span class="keyword">type</span> DivideError <span class="keyword">struct</span> &#123;</span><br><span class="line">    dividee <span class="keyword">int</span></span><br><span class="line">    divider <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现 `error` 接口</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(de *DivideError)</span> <span class="title">Error</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    strFormat := <span class="string">`</span></span><br><span class="line"><span class="string">		Cannot proceed, the divider is zero.</span></span><br><span class="line"><span class="string">		dividee: %d</span></span><br><span class="line"><span class="string">		divider: 0</span></span><br><span class="line"><span class="string">	`</span></span><br><span class="line">    <span class="keyword">return</span> fmt.Sprintf(strFormat, de.dividee)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义 `int` 类型除法运算的函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Divide</span><span class="params">(varDividee <span class="keyword">int</span>, varDivider <span class="keyword">int</span>)</span> <span class="params">(result <span class="keyword">int</span>, errorMsg <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> varDivider == <span class="number">0</span> &#123;</span><br><span class="line">        dData := DivideError&#123;</span><br><span class="line">            dividee: varDividee,</span><br><span class="line">            divider: varDivider,</span><br><span class="line">        &#125;</span><br><span class="line">        errorMsg = dData.Error()</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> varDividee / varDivider, <span class="string">&quot;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// 正常情况</span></span><br><span class="line">    <span class="keyword">if</span> result, errorMsg := Divide(<span class="number">100</span>, <span class="number">10</span>); errorMsg == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;100/10 = &quot;</span>, result)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 当被除数为零的时候会返回错误信息</span></span><br><span class="line">    <span class="keyword">if</span> _, errorMsg := Divide(<span class="number">100</span>, <span class="number">0</span>); errorMsg != <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;errorMsg is: &quot;</span>, errorMsg)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="panic"><a href="#panic" class="headerlink" title="panic"></a>panic</h2><p>panic可被意译为运行时恐慌,因为它只有在程序运行的时候才会被“抛出来”,并且，恐慌是会被扩散的,当有运行时恐慌发生时，它会被迅速地向调用栈的上层传递。如果不显式地处理它的话，程序的运行瞬间就会被终止——程序崩溃。内建函数panic可以让我们人为地产生一个运行时恐慌,不过，这种致命错误是可以被恢复的,在Go语言中，内建函数recover就可以做到这一点。</p>
<p>实际上，内建函数panic和recover是天生的一对,前者用于产生运行时恐慌，而后者用于“恢复”它。不过要注意，recover函数必须要在defer语句中调用才有效,因为一旦有运行时恐慌发生，当前函数以及在调用栈上的所有代码都是失去对流程的控制权,只有defer语句携带的函数中的代码才可能在运行时恐慌迅速向调用栈上层蔓延时“拦截到”它。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> p := <span class="built_in">recover</span>(); p != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Printf(<span class="string">&quot;Fatal error: %s\n&quot;</span>, p)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;()</span><br></pre></td></tr></table></figure>

<p>recover()函数会返回一个interface{}类型的值,如果不为nil，那么就说明当前确有运行时恐慌发生,这时我们需根据情况做相应处理。注意，一旦defer语句中的recover函数调用被执行了，运行时恐慌就会被恢复，不论是否进行了后续处理, 所以，我们一定不要只“拦截”不处理。</p>
<p>panic函数可接受一个interface{}类型的值作为其参数，也就是说，可以在调用panic函数的时候可以传入任何类型的值，不过，建议在这里只传入error类型的值,这样它表达的语义才是精确的,更重要的是，当我们调用recover函数来“恢复”由于调用panic函数而引发的运行时恐慌的时候，得到的值正是调用后者时传给它的那个参数,因此，有这样一个约定是很有必要的。</p>
<h1 id="面向对象编程"><a href="#面向对象编程" class="headerlink" title="面向对象编程"></a>面向对象编程</h1><p>在Golang的对象可以用一句话总结：“面向对象就是将要处理的数据跟函数进行绑定的方法”。</p>
<h2 id="封装"><a href="#封装" class="headerlink" title="封装"></a>封装</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Foo <span class="keyword">struct</span> &#123;</span><br><span class="line">	baz <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类似于成员函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *Foo)</span> <span class="title">echo</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(f.baz)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	f := Foo&#123;baz: <span class="string">&quot;hello&quot;</span>&#125;</span><br><span class="line">	f.echo()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Foo <span class="keyword">struct</span> &#123;</span><br><span class="line">	baz <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Bar <span class="keyword">struct</span> &#123;</span><br><span class="line">	Foo</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *Foo)</span> <span class="title">echo</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(f.baz)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	b := Bar&#123;Foo&#123;baz: <span class="string">&quot;hello&quot;</span>&#125;&#125;</span><br><span class="line">	b.echo()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="多态"><a href="#多态" class="headerlink" title="多态"></a>多态</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Foo <span class="keyword">interface</span> &#123;</span><br><span class="line">	test()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Bar <span class="keyword">struct</span> &#123;&#125;</span><br><span class="line"><span class="keyword">type</span> Baz <span class="keyword">struct</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b Bar)</span> <span class="title">test</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b Baz)</span> <span class="title">test</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> f Foo</span><br><span class="line">	f = Bar&#123;&#125;</span><br><span class="line">	f = Baz&#123;&#125;</span><br><span class="line">	fmt.Println(f)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/obj</span></span><br><span class="line"><span class="comment">// 在其他包引用时，需要把要被引用的标志首字母大写</span></span><br><span class="line"><span class="keyword">package</span> obj</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">interface</span> &#123;</span><br><span class="line">	Buy(value <span class="keyword">int</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name  <span class="keyword">string</span></span><br><span class="line">	Money <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(user *User)</span> <span class="title">Buy</span><span class="params">(value <span class="keyword">int</span>)</span></span>  &#123;</span><br><span class="line">	user.Money -= value</span><br><span class="line">	fmt.Printf(<span class="string">&quot;%s Buy a thing of %d, rest %d\n&quot;</span>, user.Name, value, user.Money)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Worker <span class="keyword">struct</span> &#123;</span><br><span class="line">	User</span><br><span class="line">	IdW <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Student <span class="keyword">struct</span> &#123;</span><br><span class="line">	IdS <span class="keyword">string</span></span><br><span class="line">	User</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// src</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	user := obj.Worker&#123;User: obj.User&#123;Name: <span class="string">&quot;hearing&quot;</span>, Money:<span class="number">21</span>&#125;, IdW: <span class="string">&quot;001&quot;</span>&#125;</span><br><span class="line">	user.Buy(<span class="number">10</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Go并发编程"><a href="#Go并发编程" class="headerlink" title="Go并发编程"></a>Go并发编程</h1><h2 id="基础概念"><a href="#基础概念" class="headerlink" title="基础概念"></a>基础概念</h2><ul>
<li>并行(parallel)：指在同一时刻，有多条指令在多个处理器上同时执行。</li>
<li>并发(concurrency)：指在同一时刻只能有一条指令执行，但多个进程指令被快速的轮换执行，使得在宏观上具有多个进程同时执行的效果，但在微观上并不是同时执行的，只是把时间分成若干段，使多个进程快速交替的执行。</li>
</ul>
<h2 id="Coroutine-协程"><a href="#Coroutine-协程" class="headerlink" title="Coroutine(协程)"></a>Coroutine(协程)</h2><p>Coroutine（协程）是一种用户态的轻量级线程，特点如下：</p>
<ol>
<li>轻量级线程</li>
<li>非抢占式多任务处理，由协程主动交出控制权。</li>
<li>编译器/解释器/虚拟机层面的任务</li>
<li>多个协程可能在一个或多个线程上运行。</li>
<li>子程序是协程的一个特例。</li>
</ol>
<p>不同语言对协程的支持：</p>
<ol>
<li>C++通过Boost.Coroutine实现对协程的支持</li>
<li>Java不支持</li>
<li>Python通过yield关键字实现协程，Python3.5开始使用async def对原生协程的支持</li>
</ol>
<h2 id="Goroutine"><a href="#Goroutine" class="headerlink" title="Goroutine"></a>Goroutine</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>goroutine说到底其实就是线程，但是它比线程更小，十几个goroutine可能体现在底层就是五六个线程，Go语言内部帮你实现了这些goroutine之间的内存共享。执行goroutine只需极少的栈内存(大概是4~5KB)，当然会根据相应的数据伸缩。</p>
<p>在Go语言中，只需要在函数调用前加上关键字go即可创建一个并发任务单元，新建的任务会被放入队列中，等待调度器安排。进程在启动的时候，会创建一个主线程，主线程结束时，程序进程将终止，因此，进程至少有一个线程。main函数里，必须让主线程等待，确保进程不会被终止。go语言中并发指的是让某个函数独立于其它函数运行的能力，一个goroutine是一个独立的工作单元，Go的runtime（运行时）会在逻辑处理器上调度goroutine来运行，一个逻辑处理器绑定一个操作系统线程，因此goroutine不是线程，是一个协程。</p>
<ul>
<li>进程：一个程序对应一个独立程序空间</li>
<li>线程：一个执行空间，一个进程可以有多个线程</li>
<li>逻辑处理器：执行创建的goroutine，绑定一个线程</li>
<li>调度器：Go运行时中的，分配goroutine给不同的逻辑处理器</li>
<li>全局运行队列：所有刚创建的goroutine队列</li>
<li>本地运行队列：逻辑处理器的goroutine队列</li>
</ul>
<p>当创建一个goroutine后，会先存放在全局运行队列中，等待Go运行时的调度器进行调度，把goroutine分配给其中的一个逻辑处理器，并放到逻辑处理器对应的本地运行队列中，最终等着被逻辑处理器执行即可。</p>
<p>Go的并发是管理、调度、执行goroutine的方式。默认情况下，Go默认会给每个可用的物理处理器都分配一个逻辑处理器。可以在程序开头使用<code>runtime.GOMAXPROCS(n)</code>设置逻辑处理器的数量。<br>如果需要设置逻辑处理器的数量，一般采用如下代码设置：<code>runtime.GOMAXPROCS(runtime.NumCPU())</code>。对于并发，Go语言本身自己实现的调度，对于并行，与物理处理器的核数有关，多核就可以并行并发，单核只能并发。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;fmt&quot;</span></span><br><span class="line">   <span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">	wg.Add(<span class="number">2</span>)</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">defer</span> wg.Done()</span><br><span class="line">		<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++ &#123;</span><br><span class="line">			fmt.Printf(<span class="string">&quot;Hello,Go.This is %d\n&quot;</span>, i)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">defer</span> wg.Done()</span><br><span class="line">		<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++ &#123;</span><br><span class="line">			fmt.Printf(<span class="string">&quot;Hello,World.This is %d\n&quot;</span>, i)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line">	wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>sync.WaitGroup使用非常简单，使用Add方法设设置计数器为2，每一个goroutine的函数执行完后，调用Done方法减1。Wait方法表示如果计数器大于0，就会阻塞，main函数会一直等待2个goroutine完成再结束。</p>
<h3 id="调度机制"><a href="#调度机制" class="headerlink" title="调度机制"></a>调度机制</h3><img src="Goroutine.png"/>

<p>为了实现M：N线程调度机制，Go引入了3个结构体：</p>
<ul>
<li>M：操作系统的内核空间线程</li>
<li>G：goroutine对象，G结构体包含调度一个goroutine所需要的堆栈和instruction pointer（IP指令指针），以及其它一些重要的调度信息。每次go调用的时候，都创建一个G对象。</li>
<li>P：Processor，调度的上下文，实现M：N调度模型的关键，M必须拿到P才能对G进行调度，P限定了go调度goroutine的最大并发度。每一个运行的M都必须绑定一个P。</li>
</ul>
<p>P的个数是GOMAXPROCS（最大256），启动时固定，一般不修改； M的个数和P的个数不一定相同（会有休眠的M或者不需要太多的M）；每一个P保存着本地G任务队列，也能使用全局G任务队列。</p>
<h3 id="runtime包"><a href="#runtime包" class="headerlink" title="runtime包"></a>runtime包</h3><ul>
<li>runtime.Gosched()用于让出CPU时间片，让出当前goroutine的执行权限，调度器安排其它等待的任务运行，并在下次某个时候从该位置恢复执行。</li>
<li>调用runtime.Goexit()将立即终止当前goroutine执⾏，调度器确保所有已注册defer延迟调用被执行。</li>
<li>调用runtime.GOMAXPROCS()用来设置可以并行计算的CPU核数的最大值，并返回设置前的值。</li>
</ul>
<h3 id="死锁"><a href="#死锁" class="headerlink" title="死锁"></a>死锁</h3><p>Go程序中死锁是指所有的goroutine在等待资源的释放,Goroutine死锁产生的原因如下：</p>
<ul>
<li>只在单一的goroutine里操作无缓冲信道，一定死锁</li>
<li>非缓冲信道上如果发生流入无流出，或者流出无流入，会导致死锁</li>
</ul>
<p>因此，解决死锁的方法有：</p>
<ul>
<li>取走无缓冲通道的数据或是发送数据到无缓冲通道</li>
<li>使用缓冲通道</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://ljd1996.github.io/2018/11/20/%E5%8E%9F%E5%88%9B%E5%AE%8B%E8%AF%8D-3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="苍耳叔叔">
      <meta itemprop="description" content="梦里寻她千百度，蓦然回首，那人却在，灯火阑珊处。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="苍耳的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/11/20/%E5%8E%9F%E5%88%9B%E5%AE%8B%E8%AF%8D-3/" class="post-title-link" itemprop="url">原创宋词-3</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-11-20 16:09:59" itemprop="dateCreated datePublished" datetime="2018-11-20T16:09:59+08:00">2018-11-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-14 14:14:57" itemprop="dateModified" datetime="2021-05-14T14:14:57+08:00">2021-05-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%96%87%E5%AD%97/" itemprop="url" rel="index"><span itemprop="name">文字</span></a>
                </span>
            </span>

          
            <span id="/2018/11/20/%E5%8E%9F%E5%88%9B%E5%AE%8B%E8%AF%8D-3/" class="post-meta-item leancloud_visitors" data-flag-title="原创宋词-3" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2018/11/20/%E5%8E%9F%E5%88%9B%E5%AE%8B%E8%AF%8D-3/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2018/11/20/%E5%8E%9F%E5%88%9B%E5%AE%8B%E8%AF%8D-3/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="定风波·湖村晚"><a href="#定风波·湖村晚" class="headerlink" title="定风波·湖村晚"></a><center>定风波·湖村晚</center></h2><p><font color="#111196"><center>苍耳</center></font></p>
<center>&nbsp;&nbsp;湖面蒹葭荡影重，黄昏渐映水寒清。远处人家芦絮乱，亲唤，小童归去老村惊。&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;候鸟返巢双戏景，微冷，农家冬至夜燃灯。灯影幢幢人影瘦，浊酒，菜花香入梦回轻。</center>

<hr>
<h2 id="忆王孙·何事"><a href="#忆王孙·何事" class="headerlink" title="忆王孙·何事"></a><center>忆王孙·何事</center></h2><p><font color="#111196"><center>苍耳</center></font></p>
<center>风吹雨落夜眠惊，半醒难分睡意轻。<br>梦入江南画柳情。<br>呓呢声，侧卧窗帘闲点灯。</center>

<hr>
<h2 id="忆王孙·洛书记"><a href="#忆王孙·洛书记" class="headerlink" title="忆王孙·洛书记"></a><center>忆王孙·洛书记</center></h2><p><font color="#111196"><center>苍耳</center></font></p>
<center>墨花纸染化龙飞，门掩窗寒瑟瑟吹。<br>今日闲情久假回。笔轻挥，平仄无声春似归。</center>

<hr>
<h2 id="青玉案·初八天"><a href="#青玉案·初八天" class="headerlink" title="青玉案·初八天"></a><center>青玉案·初八天</center></h2><p><font color="#111196"><center>苍耳</center></font></p>
<center>空山雾隐闻声去。犬出没、人来处。寒意不消听落雨。楼台风闹，绿拂三五。未见春些许。<br>夜来明灭灯如诉。酒过三巡醒梁祝。辗转难眠人不宿。贪嗔爱恨，七情六欲。梦里花开故。</center>

<hr>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://ljd1996.github.io/2018/11/20/%E5%8E%9F%E5%88%9B%E5%AE%8B%E8%AF%8D-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="苍耳叔叔">
      <meta itemprop="description" content="梦里寻她千百度，蓦然回首，那人却在，灯火阑珊处。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="苍耳的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/11/20/%E5%8E%9F%E5%88%9B%E5%AE%8B%E8%AF%8D-2/" class="post-title-link" itemprop="url">原创宋词-2</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-11-20 16:05:06" itemprop="dateCreated datePublished" datetime="2018-11-20T16:05:06+08:00">2018-11-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-14 14:14:57" itemprop="dateModified" datetime="2021-05-14T14:14:57+08:00">2021-05-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%96%87%E5%AD%97/" itemprop="url" rel="index"><span itemprop="name">文字</span></a>
                </span>
            </span>

          
            <span id="/2018/11/20/%E5%8E%9F%E5%88%9B%E5%AE%8B%E8%AF%8D-2/" class="post-meta-item leancloud_visitors" data-flag-title="原创宋词-2" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2018/11/20/%E5%8E%9F%E5%88%9B%E5%AE%8B%E8%AF%8D-2/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2018/11/20/%E5%8E%9F%E5%88%9B%E5%AE%8B%E8%AF%8D-2/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="浣溪沙·凡草"><a href="#浣溪沙·凡草" class="headerlink" title="浣溪沙·凡草"></a><center>浣溪沙·凡草</center></h2><p><font color="#111196"><center>苍耳</center></font></p>
<center>媚影妖娆咏作仙，千般颜色惹人怜。一朝散尽满枝闲。<br>最是平常孤草晃，青青风里荡花间。春泥一化百芳翩。</center>

<hr>
<h2 id="青玉案·秋书"><a href="#青玉案·秋书" class="headerlink" title="青玉案·秋书"></a><center>青玉案·秋书</center></h2><p><font color="#111196"><center>苍耳</center></font></p>
<center>&nbsp;&nbsp;林间阡陌行清秋。道凉意，风如哭。梢末黄鹂轻唤舞。却身反顾，碧空云天，尽是千金缕。&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;梧桐也似金黄雨，银杏终将叶颜枯。昨岁不堪风落处。如此这般，盈盈笑语，只是秋书苦。</center>

<hr>
<h2 id="潇湘梦-如仙"><a href="#潇湘梦-如仙" class="headerlink" title="潇湘梦-如仙"></a><center>潇湘梦-如仙</center></h2><p><font color="#111196"><center>苍耳</center></font></p>
<center>风如烟，卿画颜。<br>小楼帘下舞蹁跹。<br>浊酒几杯还故里，<br>青丝如梦九天仙。</center>

<hr>
<h2 id="点绛唇-冬醉"><a href="#点绛唇-冬醉" class="headerlink" title="点绛唇-冬醉"></a><center>点绛唇-冬醉</center></h2><p><font color="#111196"><center>苍耳</center></font><br><font color="#11AF96"><center>2018/11/20</center></font></p>
<center>雨霁天回，庭前思是春疏影。梧桐满径，凉却知冬盛。<br>念道寻禅，难揣天书命。趁酒兴，醉饮小令，一曲南山梦。</center>

<hr>
<h2 id="忆王孙·九月随想"><a href="#忆王孙·九月随想" class="headerlink" title="忆王孙·九月随想"></a><center>忆王孙·九月随想</center></h2><p><font color="#111196"><center>苍耳</center></font></p>
<center>秋风吹散雨携情，九月萧萧孤叶清。<br>半掩楼台午梦惊。<br>呓呢声，侧卧窗帘闲点灯。</center>

<hr>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://ljd1996.github.io/2018/11/20/%E9%95%BF%E6%B2%99%E5%B0%8F%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="苍耳叔叔">
      <meta itemprop="description" content="梦里寻她千百度，蓦然回首，那人却在，灯火阑珊处。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="苍耳的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/11/20/%E9%95%BF%E6%B2%99%E5%B0%8F%E8%AE%B0/" class="post-title-link" itemprop="url">长沙小记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-11-20 15:42:57" itemprop="dateCreated datePublished" datetime="2018-11-20T15:42:57+08:00">2018-11-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-14 14:14:58" itemprop="dateModified" datetime="2021-05-14T14:14:58+08:00">2021-05-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%96%87%E5%AD%97/" itemprop="url" rel="index"><span itemprop="name">文字</span></a>
                </span>
            </span>

          
            <span id="/2018/11/20/%E9%95%BF%E6%B2%99%E5%B0%8F%E8%AE%B0/" class="post-meta-item leancloud_visitors" data-flag-title="长沙小记" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2018/11/20/%E9%95%BF%E6%B2%99%E5%B0%8F%E8%AE%B0/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2018/11/20/%E9%95%BF%E6%B2%99%E5%B0%8F%E8%AE%B0/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="长沙小记"><a href="#长沙小记" class="headerlink" title="长沙小记"></a>长沙小记</h1><p>对于此次的长沙之行，其实我是期待了许久的，作为一个湖南人，我心中对长沙素来是有好感的，不止因为它的美食，也因它的风味。故而虽一路上比较颠簸，吐槽抱怨之余却也有几丝欣然的期待。</p>
<p>甫一下车，一行人便前往参观了深信服公司，对于我们所受到的招待，心中总有种受宠若惊的感觉，也体会到了他们公司对我们团队的尊重与重视。</p>
<p>参观完毕，而后便是一天半的自由活动了。对于长沙的美食小吃，我早已垂涎已久，所以晚上便火急火燎地溜出去觅食，第二天中午也在岳麓山脚下吃了一顿火锅。作为一个无辣不欢的湖南人，武汉待得久了，却也会开始觉得长沙的食物是辣的，从满是红油的火锅里夹出一块熟肉放入口中，不禁大呼过瘾，却也被辣得满头大汗，还被同行的伙伴轻嘲了我的窘态。长沙的辣，在我看来是一种很用心的辣，而不是单纯的辣椒与食物搅拌在一起的轻浮的辣，它能很快地敲击你的味蕾，让你马上便陷入其中，挣脱不得。</p>
<p>我也喜欢长沙的景，岳麓山脚的瀑布，有种长沙的小家碧玉之感。山腰的茶颜悦色，也尽是怡人的平静。而最让我深刻的，还是山顶上的红枫与山脚下的银杏了，红枫的枝叶小巧，不似华科里的法桐叶般硕大，它眉眼低垂，随寒风的方向来来去去，却又不脱离枝头，世故而有自己的底线。若说红枫让我感觉到了岳麓山的坚强，那路两旁的银杏，则是有几分冷冽寒风里的浪漫了，约一个阔别已久的朋友，在满是银杏叶的路上走走停停，抬头即是漫天的金黄色，风一吹，便又带下了几片，不觉凄凉，倒是有几分诗人般的浪漫。</p>
<p>回校的车上，肚子有些饿了，却又是开始想念起东小门外阿姨的烧烤了，虽是一身疲惫，却没了睡意，便约了咸鱼和矢量，踏着启明路上的法桐落叶，出东小门右拐，视眼所及，尽是熟悉的灯火璀璨。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://ljd1996.github.io/2018/11/20/2018%E4%B8%AA%E4%BA%BA%E5%B0%8F%E7%BB%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.png">
      <meta itemprop="name" content="苍耳叔叔">
      <meta itemprop="description" content="梦里寻她千百度，蓦然回首，那人却在，灯火阑珊处。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="苍耳的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/11/20/2018%E4%B8%AA%E4%BA%BA%E5%B0%8F%E7%BB%93/" class="post-title-link" itemprop="url">2018个人小结</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-11-20 10:59:10" itemprop="dateCreated datePublished" datetime="2018-11-20T10:59:10+08:00">2018-11-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-14 14:14:57" itemprop="dateModified" datetime="2021-05-14T14:14:57+08:00">2021-05-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%96%87%E5%AD%97/" itemprop="url" rel="index"><span itemprop="name">文字</span></a>
                </span>
            </span>

          
            <span id="/2018/11/20/2018%E4%B8%AA%E4%BA%BA%E5%B0%8F%E7%BB%93/" class="post-meta-item leancloud_visitors" data-flag-title="2018个人小结" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2018/11/20/2018%E4%B8%AA%E4%BA%BA%E5%B0%8F%E7%BB%93/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2018/11/20/2018%E4%B8%AA%E4%BA%BA%E5%B0%8F%E7%BB%93/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="2018个人小结"><a href="#2018个人小结" class="headerlink" title="2018个人小结"></a>2018个人小结</h1><p>白驹过隙，蓦然回首，却又是一年。大学的时光虽然漫长却来去匆匆，回顾我的大学前两年，大部分时光都在浑浑噩噩中度过，或流失眼前，或离于脚底。所幸我能加入Dian这个团队，让我能够在茫然的混沌中，看到新的方向。</p>
<p>在过去的一年里，我在启亦电子组和深信服组中共做了两个项目，通过宵，赖过床，起过早，离过晚。在这些项目上的经历，都是我未来技术路上的积累。项目之外，也结识了一群有趣的人，而他们，也让我开始渐渐变得有趣了起来。</p>
<p>启亦的项目是我进入团队之后最先开始接触的项目，从去年被优神带着做Android，到今年扫频仪的项目里，我开始渐渐一个人负责Android端的开发，虽然一开始代码写得还是很矬，但随着项目的发展，我在这方面的能力也得到了比较大的提升。那段时间，我们项目组也会经常跑去启亦公司去做联调，有时是与矢量，咸鱼去，有时也会有晓纤。那段时间，我总有种感觉，觉得只要我们几个人在一起，什么问题都可以慢慢解决。在启亦公司调Bug的时光，也许是我在团队的这些日子里，最开心的一段时间了吧。</p>
<p>后来我离开了启亦，于是整个暑假便掉入了深信服组的坑，失足少年，整个暑假都没有回家。可能是我性子的原因吧，当我在做一件事的时候，便喜欢整个身心都投进去，偶尔会觉得累，但又停不下自己的手。在做深信服项目的时候，常常是待在实验室最久的人之一，有时也会与邹君和小红在实验室通宵。不过虽然累，却让我的成长比较迅速，同时，让我觉得更为珍贵的是，我又认识了一些新的小朋友，如时常会让我不得不给她收拾桌子的邹琪珺，勤劳又有点迷的小红，骚气的曾老师，还有之前就认识的一些团队里的朋友，也更为熟悉了起来。</p>
<p>后来就开始找起了工作，由于在深信服组待了一个暑假，所以对找工作的一些东西没有做好准备，一开始找工作的时候，屡屡碰壁，同时也错过许多比较好的公司的校招机会。所幸有团队做的项目上的经历，最后还是找到了一份还不错的工作。</p>
<p>一年已过，愿我能不负所望，也愿团队的未来越来越好。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/13/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/13/">13</a><span class="page-number current">14</span><a class="page-number" href="/page/15/">15</a><span class="space">&hellip;</span><a class="page-number" href="/page/17/">17</a><a class="extend next" rel="next" href="/page/15/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="苍耳叔叔"
      src="/images/head.png">
  <p class="site-author-name" itemprop="name">苍耳叔叔</p>
  <div class="site-description" itemprop="description">梦里寻她千百度，蓦然回首，那人却在，灯火阑珊处。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">168</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">41</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">100</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/ljd1996" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;ljd1996" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:hearing1996@gmail.com" title="E-Mail → mailto:hearing1996@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">苍耳叔叔</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : true,
      notify     : true,
      appId      : 'pCnIlzs46HJGpubm7D3TnrBC-gzGzoHsz',
      appKey     : '7LzW4wBI9lY5DtVFNkFWcjs0',
      placeholder: "欢迎评论交流！",
      avatar     : 'robohash',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
